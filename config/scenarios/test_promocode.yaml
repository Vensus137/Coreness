# –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
promocode_main:
  actions:
    - type: "user"
      user_state: ""
    - type: send
      text: |
        üé´ <b>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</b>
        
        –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
        ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        ‚Ä¢ üé≤ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞
        ‚Ä¢ üîí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞
        ‚Ä¢ ‚úèÔ∏è –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
        ‚Ä¢ üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞
        ‚Ä¢ üìã –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        ‚Ä¢ üåê –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
        
        <i>–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –¥–µ–π—Å—Ç–≤–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤.</i>
      inline:
        - [{"üé≤ –°–ª—É—á–∞–π–Ω—ã–π": "promocode_random"}, {"üîí –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π": "promocode_deterministic"}]
        - [{"‚úèÔ∏è –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è": "promocode_modify"}, {"üîç –ü—Ä–æ–≤–µ—Ä–∫–∞": "promocode_check_state"}]
        - [{"üìã –ú–æ–∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã": "promocode_user_list"}, {"üåê –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ": "promocode_all_active"}]
        - [{"üîô –ú–µ–Ω—é": "start_menu"}]

# =============================================================================
# –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–õ–£–ß–ê–ô–ù–û–ì–û –ü–†–û–ú–û–ö–û–î–ê
# =============================================================================

promocode_random:
  actions:
    - type: create_promo
      promo_name: "test_random"
      length: 8
      use_digits: true
      use_letters: true
      use_random: true
    - type: send
      text: |
        üé≤ <b>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞</b>
        
        –°–æ–∑–¥–∞—é —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
        ‚Ä¢ –î–ª–∏–Ω–∞: <code>{promo_code|length}</code> —Å–∏–º–≤–æ–ª–æ–≤
        ‚Ä¢ –¶–∏—Ñ—Ä—ã: <code>{use_digits|fallback:None}</code>
        ‚Ä¢ –ë—É–∫–≤—ã: <code>{use_letters|fallback:None}</code>
        ‚Ä¢ –°–ª—É—á–∞–π–Ω—ã–π: <code>{use_random|fallback:None}</code>
        
        <i>–ü—Ä–æ–º–æ–∫–æ–¥ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.</i>

        –í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥: <code>{promo_code}</code> –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ <code>{expired_at|format:date}</code>
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true

# =============================================================================
# –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–û–°–¢–û–Ø–ù–ù–û–ì–û –ü–†–û–ú–û–ö–û–î–ê
# =============================================================================

promocode_deterministic:
  actions:
    - type: create_promo
      promo_name: "test_deterministic"
      target_user_id: "Any"  # –î–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º
      length: 10
      use_digits: true
      use_letters: false
      use_random: false
    - type: send
      text: |
        üîí <b>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞</b>
        
        –°–æ–∑–¥–∞—é –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
        ‚Ä¢ –î–ª–∏–Ω–∞: <code>{promo_code|length}</code> —Å–∏–º–≤–æ–ª–æ–≤
        ‚Ä¢ –¶–∏—Ñ—Ä—ã: <code>{use_digits|fallback:None}</code>
        ‚Ä¢ –ë—É–∫–≤—ã: <code>{use_letters|fallback:None}</code>
        ‚Ä¢ –°–ª—É—á–∞–π–Ω—ã–π: <code>{use_random|fallback:None}</code>
        ‚Ä¢ –°–æ–ª—å: <code>{salt|fallback:None}</code>
        
        <i>–ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–¥.</i>

        –í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥: <code>{promo_code}</code> –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ <code>{expired_at|format:date}</code>
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true

# =============================================================================
# –ú–û–î–ò–§–ò–ö–ê–¶–ò–Ø –ü–†–û–ú–û–ö–û–î–ê
# =============================================================================

promocode_modify:
  actions:
    - type: modify_promo
      promo_id: 1  # ID –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
      promo_name: "new_name"
      target_user_id: "Any"  # –°–¥–µ–ª–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤—Å–µ–º
    - type: send
      text: |
        ‚úèÔ∏è <b>–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</b>
        
        –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é –ø—Ä–æ–º–æ–∫–æ–¥ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
        ‚Ä¢ ID: <code>{promo_id}</code>
        ‚Ä¢ –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: <code>{promo_name}</code>
        ‚Ä¢ –î–æ—Å—Ç—É–ø: –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        
        <i>–ü—Ä–æ–º–æ–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</i>

        –†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏: <code>{promo_code}</code> –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ <code>{expired_at|format:date}</code>
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true

# =============================================================================
# –ü–†–û–í–ï–†–ö–ê –ü–†–û–ú–û–ö–û–î–ê
# =============================================================================

promocode_check_state:
  actions:
    - type: "user"
      user_state: "promocode_check"
      expire: 120s
    - type: send
      text: |
        –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true

promocode_check:
  actions:
    - type: validator
      promo_code: "{event_text|regex:^[A-Za-z0-9]+$}"
      placeholder: true
    - type: check_promo
      chain: true
    - type: send
      text: |
        üîç <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞</b>
        
        –ü—Ä–æ–≤–µ—Ä—è—é –ø—Ä–æ–º–æ–∫–æ–¥ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
        ‚Ä¢ –ö–æ–¥: <code>{promo_code}</code>
        
        <i>–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∏–ª–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.</i>

        –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: <code>{promo_available}</code> –¥–æ—Å—Ç—É–ø–µ–Ω –¥–æ <code>{promo_data.expired_at|format:date}</code>
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true
    - type: user
      user_state: ""
      chain: true

# =============================================================================
# –°–ü–ò–°–û–ö –ü–†–û–ú–û–ö–û–î–û–í –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
# =============================================================================

promocode_user_list:
  actions:
    - type: promo_management
      operation: "list"
      user_filter: "{user_id}"
    - type: send
      text: |
        üìã <b>–í–∞—à–∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã</b>
        
        {response_text}
        
        <i>–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–º–æ–∫–æ–¥–∞ –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ ID –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.</i>
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true
    - type: user
      user_state: "promocode_details"
      chain: true

# =============================================================================
# –°–ü–ò–°–û–ö –í–°–ï–• –ê–ö–¢–ò–í–ù–´–• –ü–†–û–ú–û–ö–û–î–û–í
# =============================================================================

promocode_all_active:
  actions:
    - type: promo_management
      operation: "list"
      status: "active"  # –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
    - type: send
      text: |
        üåê <b>–í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</b>
        
        {response_text}
        
        <i>–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–º–æ–∫–æ–¥–∞ –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ ID –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.</i>
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true
    - type: user
      user_state: "promocode_details"
      chain: true

# =============================================================================
# –ü–û–ö–ê–ó –î–ï–¢–ê–õ–ï–ô –ü–†–û–ú–û–ö–û–î–ê –ü–û ID
# =============================================================================

promocode_details:
  actions:
    - type: validator
      promo_id: "{event_text|regex:^[0-9]+$}"
      placeholder: true
    - type: promo_management
      operation: "details"
      promo_id: "{promo_id}"
      chain: true
    - type: send
      text: |
        üîç <b>–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ #{promo_id}</b>
        
        {response_text}
        
        <i>–ü—Ä–æ–º–æ–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.</i>
      inline:
        - [{"üîô –ù–∞–∑–∞–¥": "promocode_main"}]
      callback_edit: false
      chain: true
    - type: user
      user_state: ""
      chain: true

# =============================================================================
# –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò
# =============================================================================

# –°—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (—Å —É–¥–∞–ª–µ–Ω–∏–µ–º)
promocode_main_clean:
  actions:
    - type: remove
    - type: scenario
      value: "promocode_main"