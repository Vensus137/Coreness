# ============================================
# –ê–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —Å–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≤–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
# ============================================

# –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∑–∞–≥—Ä—É–∑–∫–∏
loading_menu:
  description: "–ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏"
  
  trigger:
    - event_type: "message"
      event_text: "/loading"
    - event_type: "callback"
      callback_data: "loading_menu"

  step:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
    - action: "execute_scenario"
      params:
        scenario: "access_check"
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ–Ω—é —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    - action: "send_message"
      params:
        text: |
          üé® <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏:</b>
          
          –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
        inline:
          - [{"–¢–æ—á–∫–∏": "loading_dots"}, {"–¢–æ—á–∫–∏ (–ø—É–ª—å—Å)": "loading_emoji"}]
          - [{"–≠–º–æ–¥–∑–∏-–ø—Ä–æ–≥—Ä–µ—Å—Å": "loading_emoji_progress"}, {"–í–æ–ª–Ω–∞": "loading_wave"}]
          - [{"–ü—É–ª—å—Å": "loading_pulse"}, {"–î–≤–µ —Ç–æ—á–∫–∏": "loading_double_dots"}]
          - [{"–ü–ª–∞–Ω–µ—Ç—ã": "loading_planets"}, {"–õ—É–Ω–∞": "loading_moon"}]
          - [{"–ü—É–ª—å—Å (–ø—Ä–æ—Å—Ç–æ–π)": "loading_simple_pulse"}, {"–í–æ–ª–Ω–∞ (–ø—Ä–æ—Å—Ç–∞—è)": "loading_simple_wave"}]
          - [{"–î–≤–µ —Ç–æ—á–∫–∏ (–ø—Ä–æ—Å—Ç–æ)": "loading_simple_double_dots"}]

# –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
loading_animation:
  description: "–¢–µ—Å—Ç –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ - —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è"
  
  trigger:
    - event_type: "callback"
      callback_data: "loading_dots"
    - event_type: "callback"
      callback_data: "loading_emoji"
    - event_type: "callback"
      callback_data: "loading_emoji_progress"
    - event_type: "callback"
      callback_data: "loading_pulse"
    - event_type: "callback"
      callback_data: "loading_wave"
    - event_type: "callback"
      callback_data: "loading_double_dots"
    - event_type: "callback"
      callback_data: "loading_planets"
    - event_type: "callback"
      callback_data: "loading_moon"
    - event_type: "callback"
      callback_data: "loading_simple_pulse"
    - event_type: "callback"
      callback_data: "loading_simple_wave"
    - event_type: "callback"
      callback_data: "loading_simple_double_dots"
  
  step:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
    - action: "execute_scenario"
      params:
        scenario: "access_check"
    
    # –®–∞–≥ 0: –ó–∞–ø—É—Å–∫–∞–µ–º sleep –≤ —Ñ–æ–Ω–µ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –¥–æ–ª–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    - action: "sleep"
      async: true
      action_id: "loading_sleep"
      params:
        seconds: 5.0
    
    # –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∫—ç—à
    - action: "execute_scenario"
      params:
        scenario: "loading_init_data"
      transition:
        - action_result: "any"
          transition_action: "move_steps"
          transition_value: 2  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑, –ø–æ–ø–∞–¥–∞–µ–º –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    
    # –®–∞–≥ 2: –®–∞–≥ –∞–Ω–∏–º–∞—Ü–∏–∏ (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑)
    - action: "execute_scenario"
      params:
        scenario: "loading_animation_step"
    
    # –®–∞–≥ 3: –¶–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    - action: "validate"
      params:
        condition: "{_async_action.loading_sleep|ready} == True"
      transition:
        - action_result: "success"
          transition_action: "move_steps"
          transition_value: 1  # –ì–æ—Ç–æ–≤–æ - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
        - action_result: "failed"
          transition_action: "move_steps"
          transition_value: -1  # –ù–µ –≥–æ—Ç–æ–≤–æ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —à–∞–≥ –∞–Ω–∏–º–∞—Ü–∏–∏ (—à–∞–≥ 2)
    
    # –®–∞–≥ 4: –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
    - action: "send_message"
      params:
        text: |
          ‚úÖ <b>–ì–æ—Ç–æ–≤–æ!</b>
          
          –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.
          –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 5 —Å–µ–∫—É–Ω–¥
        message_edit: "{_cache.loading_data.loading_message_id}"

# –ü–æ–¥—Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
loading_init_data:
  description: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏"
  # –ù–ï–¢ –¢–†–ò–ì–ì–ï–†–û–í - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
  
  step:
    # –®–∞–≥ 0: –ü–æ–ª—É—á–∞–µ–º –≥—Ä—É–ø–ø—É ui —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
    - action: "get_storage"
      params:
        group_key: "ui"
    
    # –®–∞–≥ 1: –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∫—ç—à
    # –¢–∏–ø –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ callback_data –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    - action: "set_cache"
      params:
        _namespace: "loading_data"
        cache:
          loading_type: "{callback_data|regex:loading_(.+)}"
          loading_messages: "{_cache.storage_values.loading_animations.{callback_data|regex:loading_(.+)}.messages}"
          loading_interval: "{_cache.storage_values.loading_animations.{callback_data|regex:loading_(.+)}.interval}"
          loading_index: 0
          loading_array_length: "{_cache.storage_values.loading_animations.{callback_data|regex:loading_(.+)}.messages|length}"

# –ü–æ–¥—Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
loading_animation_step:
  description: "–û–¥–∏–Ω —à–∞–≥ –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞"
  # –ù–ï–¢ –¢–†–ò–ì–ì–ï–†–û–í - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
  
  step:
    # –®–∞–≥ 0: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –ø–æ —Ç–µ–∫—É—â–µ–º—É –∏–Ω–¥–µ–∫—Å—É
    - action: "send_message"
      params:
        text: "{_cache.loading_data.loading_messages[{_cache.loading_data.loading_index}]}"
        message_edit: "{_cache.loading_data.loading_message_id|fallback:false}"
    
    # –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ message_id
    # –ï—Å–ª–∏ –µ–≥–æ –Ω–µ –±—ã–ª–æ (–±—ã–ª None), —Å–æ—Ö—Ä–∞–Ω—è–µ–º last_message_id –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    - action: "validate"
      params:
        condition: "{_cache.loading_data.loading_message_id|is_null} == False"
      transition:
        - action_result: "success"
          transition_action: "move_steps"
          transition_value: 2  # –£–∂–µ –µ—Å—Ç—å - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∏–¥–µ–º –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –∏–Ω–¥–µ–∫—Å–∞
        - action_result: "failed"
          transition_action: "continue"  # –ù–µ—Ç - —Å–æ—Ö—Ä–∞–Ω—è–µ–º last_message_id

    # –®–∞–≥ 2: –°–æ—Ö—Ä–∞–Ω—è–µ–º message_id –≤ –∫—ç—à
    - action: "set_cache"
      params:
        _namespace: "loading_data"
        cache:
          loading_message_id: "{_cache.last_message_id}"
    
    # –®–∞–≥ 3: –í—ã—á–∏—Å–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∏–Ω–¥–µ–∫—Å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
    - action: "set_cache"
      params:
        _namespace: "loading_data"
        cache:
          loading_index: "{_cache.loading_data.loading_index|+1}"
    
    # –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏ –¥–ª–∏–Ω—É –º–∞—Å—Å–∏–≤–∞
    - action: "validate"
      params:
        condition: "{_cache.loading_data.loading_index} >= {_cache.loading_data.loading_array_length}"
      transition:
        - action_result: "success"
          transition_action: "continue"  # –ü—Ä–µ–≤—ã—Å–∏–ª–∏ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ 0
        - action_result: "failed"
          transition_action: "move_steps"
          transition_value: 2  # –ù–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ - –∏–Ω–¥–µ–∫—Å —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–±—Ä–æ—Å
    
    # –®–∞–≥ 5: –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ 0
    - action: "set_cache"
      params:
        _namespace: "loading_data"
        cache:
          loading_index: 0
    
    # –®–∞–≥ 6: –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–µ–π
    - action: "sleep"
      params:
        seconds: "{_cache.loading_data.loading_interval|+0}"

