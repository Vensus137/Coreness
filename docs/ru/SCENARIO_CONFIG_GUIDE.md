---
title: Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÑŽ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²
description: ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÑŽ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² Ð´Ð»Ñ Telegram-Ð±Ð¾Ñ‚Ð¾Ð². Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹, Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ, Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹, Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹ Ð¸ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸.
keywords: ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ telegram Ð±Ð¾Ñ‚Ð¾Ð², YAML ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ, Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹, Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹, Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹ Ð¼ÐµÐ¶Ð´Ñƒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÐ¼Ð¸
---

# Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÑŽ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²

> **ðŸ“– ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾** Ð¿Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÑŽ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² Ð´Ð»Ñ Telegram-Ð±Ð¾Ñ‚Ð¾Ð² Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð¾Ð², Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð² Ð¸ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð»Ð¾Ð³Ð¸ÐºÐ¸.

## ðŸ“‹ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ

### ÐžÑ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²

**ÐžÑ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð¾Ð²** â€” ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¾Ð²Ñ‹Ð²Ð°Ñ‚ÑŒ Ð² Ð¿Ð°Ð¿ÐºÐ¸ Ð¸ Ð¿Ð¾Ð´Ð¿Ð°Ð¿ÐºÐ¸ Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð°. Ð’ÑÐµ YAML-Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸Ð· Ð¿Ð°Ð¿ÐºÐ¸ `scenarios/` (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð¿Ð¾Ð´Ð¿Ð°Ð¿ÐºÐ¸) Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ.

**Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñ‹:**
- **Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ð¹:** ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð²ÑÐµÐ³Ð¾ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
- **Ð“Ð¸Ð±ÐºÐ°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²:** ÐœÐ¾Ð¶Ð½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»Ñ‹ Ñ Ð»ÑŽÐ±Ñ‹Ð¼Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑÐ¼Ð¸ Ð¸ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¾Ð²Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… Ð² Ð¿Ð¾Ð´Ð¿Ð°Ð¿ÐºÐ¸ â€” Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹
- **Ð ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°:** Ð’ÑÐµ YAML-Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸Ð· `scenarios/` Ð¸ Ð²ÑÐµÑ… Ð¿Ð¾Ð´Ð¿Ð°Ð¿Ð¾Ðº Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð°Ñ€ÑÑÑ‚ÑÑ
- **Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹:** Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ðº Ð»ÑŽÐ±Ñ‹Ð¼ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÐ¼ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° Ñ‡ÐµÑ€ÐµÐ· `jump_to_scenario`

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹:**
```
tenant_101/
  scenarios/
    commands.yaml           # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸: start, menu, help
    settings.yaml           # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸: settings, profile
    admin/                  # ÐŸÐ¾Ð´Ð¿Ð°Ð¿ÐºÐ° Ð´Ð»Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸
      panel.yaml            # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸: admin_panel, logs
      moderation.yaml       # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸: ban, kick
    users/                  # Ð•Ñ‰Ðµ Ð¾Ð´Ð½Ð° Ð¿Ð¾Ð´Ð¿Ð°Ð¿ÐºÐ°
      profile.yaml          # Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸: user_profile, edit_profile
```

Ð’ ÑÑ‚Ð¾Ð¼ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ:
- Ð’ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸Ð· `scenarios/` Ð¸ Ð¿Ð¾Ð´Ð¿Ð°Ð¿Ð¾Ðº Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
- Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³ Ðº Ð´Ñ€ÑƒÐ³Ñƒ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ð¾Ñ‚ Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð² Ð¿Ð°Ð¿ÐºÐ°Ñ…
- ÐŸÐ¾Ð´Ð¿Ð°Ð¿ÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ„Ð°Ð¹Ð»Ð¾Ð²

**Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° YAML Ñ„Ð°Ð¹Ð»Ð°:**
```yaml
# ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ
scenario_name:
  description: "ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)"

  # Ð£ÑÐ»Ð¾Ð²Ð¸Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²)
  trigger:
    - event_type: "message"
      event_text: "/start"
    - event_type: "callback"
      callback_data: "start"

  # Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, cron Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ)
  schedule: "0 9 * * *"  # ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 9:00

  # Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ
  step:
    - action: "send_message"
      params:
        text: "ÐŸÑ€Ð¸Ð²ÐµÑ‚!"
        inline:
          - [{"ÐšÐ½Ð¾Ð¿ÐºÐ°": "callback_data"}]
```

### ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ:

- **`description`** â€” Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
- **`trigger`** â€” ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²)
- **`schedule`** â€” cron Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
- **`step`** â€” Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹

### ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÑ€:

```yaml
user_registration:
  description: "ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°Ð¼Ð¸ Ð¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸ÑÐ¼Ð¸"
  
  # Ð¢Ð Ð˜Ð“Ð“Ð•Ð Ð«: ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ - Ð»ÑŽÐ±Ð¾Ð¹ Ð¸Ð· Ð½Ð¸Ñ… Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹
  trigger:
    - event_type: "message"      # ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° /register
      event_text: "/register"
    - event_type: "callback"     # ÐšÐ½Ð¾Ð¿ÐºÐ° "ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ"  
      callback_data: "start_registration"

  # Ð¨ÐÐ“Ð˜: Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ð´Ð¸Ð½ Ð·Ð° Ð´Ñ€ÑƒÐ³Ð¸Ð¼
  step:
    # Ð¨Ð°Ð³ 1: ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ
    - action: "send_message"
      params:
        text: |
          ðŸ‘‹ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ, {username|fallback:Ð“Ð¾ÑÑ‚ÑŒ}!
          
          Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð²Ð°Ñ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ.
        inline:
          - [{"âœ… ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ": "continue_registration"}]

    # Ð¨Ð°Ð³ 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ñ€Ð°Ð²Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ñ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð°Ð¼Ð¸
    - action: "validate"
      params:
        condition: "$user_role == 'admin'"
      transition:
        - action_result: "success"
          transition_action: "jump_to_scenario"
          transition_value: "admin_welcome"        # ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ðº Ð°Ð´Ð¼Ð¸Ð½ÑÐºÐ¾Ð¼Ñƒ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸ÑŽ
        - action_result: "error"
          transition_action: "continue"            # ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ð¿Ð¾Ñ‚Ð¾Ðº Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
    
    # Ð¨Ð°Ð³ 3: Ð—Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÐ¼ Ð¸Ð¼Ñ
    - action: "send_message"
      params:
        text: |
          ðŸ“ Ð¨Ð°Ð³ 2 Ð¸Ð· 3
          
          ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ:
        inline:
          - [{"âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°": "cancel_registration"}]
    
    # Ð¨Ð°Ð³ 4: ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ñ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑÐ¼Ð¸
    - action: "send_message"
      params:
        text: |
          âœ… Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð½Ð°Ñ‡Ð°Ñ‚Ð°!
          
          ÐœÑ‹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¸ Ð²Ð°Ð¼ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð½Ð° email.
          ðŸ“Ž Ð¢Ð°ÐºÐ¶Ðµ Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹:
        attachment:
          - file_id: "AgACAgIAAxkBAAIUJWjyLorr_d8Jwof3V_gVjVNdGHyXAAJ--zEb4vGQS-a9UiGzpkTNAQADAgADeQADNgW"
            type: "photo"
          - file_id: "AgACAgIAAxkBAAIUQWjyOH65wQYR4onkrrqM4J65yUD7AAM8-zEb4vGQS1mwvckFcZHlAQADAgADdwADNgQ"
            type: "photo"
        inline:
          - [{"ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ": "main_menu"}]
    
    # Ð¨Ð°Ð³ 5: Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
    - action: "delete_message"
      params:
        delete_message_id: "{last_message_id}"  # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ID Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ

admin_welcome:
  description: "ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð´Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¾Ð² (Ñ‚Ñ€Ð°Ð½Ð·Ð¸ÑˆÐ½-ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹)"
  # ÐÐ•Ð¢ Ð¢Ð Ð˜Ð“Ð“Ð•Ð ÐžÐ’ - Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ð¾
  
  step:
    - action: "send_message"
      params:
        text: |
          ðŸ”§ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ, Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€!
          
          Ð£ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð°.
        inline:
          - [{"âš™ï¸ ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ": "admin_panel"}]
```

**ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹:**
- **Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹** â€” Ð»Ð¾Ð³Ð¸ÐºÐ° Ð˜Ð›Ð˜: ÐµÑÐ»Ð¸ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð» Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð¸Ð½, ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ
- **Ð¨Ð°Ð³Ð¸** â€” Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾ Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ Ð·Ð°Ð¿Ð¸ÑÐ¸
- **ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹** â€” ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ Ð¿Ð¾Ñ‚Ð¾ÐºÐ¾Ð¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· `transition`:
  - `continue` â€” Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹
  - `break` â€” Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ
  - `abort` â€” Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²ÑÑŽ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ)
  - `stop` â€” Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²ÑÑŽ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ (Ð²ÑÐµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸)
  - `move_steps` â€” Ð¿ÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒÑÑ Ð½Ð° ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑˆÐ°Ð³Ð¾Ð² (Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ = Ð²Ð¿ÐµÑ€ÐµÐ´, Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ = Ð½Ð°Ð·Ð°Ð´)
  - `jump_to_step` â€” Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ ÑˆÐ°Ð³Ñƒ Ð¿Ð¾ Ð¸Ð½Ð´ÐµÐºÑÑƒ (ÑˆÐ°Ð³Ð¸ Ð½ÑƒÐ¼ÐµÑ€ÑƒÑŽÑ‚ÑÑ Ñ 0)
  - `jump_to_scenario` â€” Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ð´Ñ€ÑƒÐ³Ð¾Ð¼Ñƒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ (Ðº Ð»ÑŽÐ±Ð¾Ð¼Ñƒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°)
- **Ð¢Ñ€Ð°Ð½Ð·Ð¸ÑˆÐ½-ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸** â€” ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð±ÐµÐ· Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¾Ð², Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ð¾ Ð¸Ð· Ð´Ñ€ÑƒÐ³Ð¸Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²
- **Scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸** â€” ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ñ Ð¿Ð¾Ð»ÐµÐ¼ `schedule` (cron Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ), Ð·Ð°Ð¿ÑƒÑÐºÐ°ÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ
- **Ð“Ð¸Ð±Ñ€Ð¸Ð´Ð½Ñ‹Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸** â€” Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ Ð¸ `trigger`, Ð¸ `schedule` Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ (Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð¿Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼ Ð˜ Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ)
- **Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ** â€” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ (user_id, chat_id, timestamp Ð¸ Ð´Ñ€.)
- **Ð’Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ** â€” Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿ÐµÑ€ÐµÑÑ‹Ð»Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»Ñ‹ Ñ‡ÐµÑ€ÐµÐ· `attachment[0].file_id` Ð¸ `attachment[0].type`

---

## ðŸŽ¯ Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹ (trigger)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð£ÑÐ»Ð¾Ð²Ð¸Ñ, Ð¿Ñ€Ð¸ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹.

### ÐœÐµÑ…Ð°Ð½Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¾Ð²:

**ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ñ„Ð¾Ñ€Ð¼Ð°** (Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹):
```yaml
trigger:
  - event_type: "message"
    event_text: "/start"
```

**ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÑ‚ÑÑ Ð² ÑƒÑÐ»Ð¾Ð²Ð¸Ðµ:**
```python
$event_type == "message" and $event_text == "/start"
```

**Ð¡Ð»Ð¾Ð¶Ð½Ð°Ñ Ñ„Ð¾Ñ€Ð¼Ð°** (Ñ `condition`):
```yaml
trigger:
  - event_type: "message"
    condition: |
      $event_text == "test"
      and $user_id > 100
      or $username in ('@admin', '@moderator')
```

**ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÑ‚ÑÑ Ð² ÑƒÑÐ»Ð¾Ð²Ð¸Ðµ:**
```python
$event_type == "message" and ($event_text == "test" and $user_id > 100 or $username in ('@admin', '@moderator'))
```

### Ð›Ð¾Ð³Ð¸ÐºÐ° Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¾Ð²:

- **ÐœÐµÐ¶Ð´Ñƒ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°Ð¼Ð¸** â€” Ð»Ð¾Ð³Ð¸ÐºÐ° **Ð˜Ð›Ð˜** (OR): ÐµÑÐ»Ð¸ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð» Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð¸Ð½, ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ
- **Ð’Ð½ÑƒÑ‚Ñ€Ð¸ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°** â€” Ð»Ð¾Ð³Ð¸ÐºÐ° **Ð˜** (AND): Ð²ÑÐµ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒÑÑ
- **Ð’ condition** â€” Ð¿Ð¾Ð»Ð½Ð°Ñ ÑÐ²Ð¾Ð±Ð¾Ð´Ð°: `and`, `or`, `not`, ÑÐºÐ¾Ð±ÐºÐ¸, Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹

### âš ï¸ Ð’Ð°Ð¶Ð½Ð¾: ÐŸÐ»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹ Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ… condition

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** ÐŸÑ€Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð¾Ð² Ð² `condition` Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¾Ð² Ð´Ð»Ñ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ ÑÑ‚Ñ€Ð¾Ðº Ð½ÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°Ñ‚ÑŒ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ Ð² ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸. Ð˜Ð½Ð°Ñ‡Ðµ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ Ð±ÑƒÐ´ÐµÑ‚ "Ñ€Ð°Ð·Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°Ñ‚ÑŒÑÑ" ÐºÐ°Ðº Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² `condition_parser`, Ð° Ð½Ðµ ÐºÐ°Ðº ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð’ÑÐµÐ³Ð´Ð° Ð¾Ð±Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹ Ð² ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð¿Ñ€Ð¸ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ð¸ ÑÑ‚Ñ€Ð¾Ðº Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ….

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:**

```yaml
# âŒ ÐžÐ¨Ð˜Ð‘ÐšÐ - Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÐµÑ‚ÑÑ Ð² random_user Ð±ÐµÐ· ÐºÐ°Ð²Ñ‹Ñ‡ÐµÐº
# condition_parser Ð¿Ð¾Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð½Ð°Ð¹Ñ‚Ð¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ random_user Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ…
trigger:
  - event_type: "message"
    condition: "{_cache.detected_intent} == 'random_user'"
    # ÐŸÐ¾ÑÐ»Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°: random_user == 'random_user'
    # condition_parser Ð¸Ñ‰ÐµÑ‚ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ random_user Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð° Ð½Ðµ ÑÑ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¸!

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ Ð¾Ð±ÐµÑ€Ð½ÑƒÑ‚ Ð² ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸
trigger:
  - event_type: "message"
    condition: "'{_cache.detected_intent}' == 'random_user'"
    # ÐŸÐ¾ÑÐ»Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°: 'random_user' == 'random_user'
    # condition_parser ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ ÑÑ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¸

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ‡Ð¸ÑÐµÐ» (ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ñ‹)
trigger:
  - event_type: "message"
    condition: "{user_id} > 100"
    # ÐŸÐ¾ÑÐ»Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°: 12345 > 100
    # Ð§Ð¸ÑÐ»Ð¾Ð²Ð¾Ðµ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð°Ð¼Ð¸ (ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ñ‹ Ð´Ð»Ñ boolean)
trigger:
  - event_type: "message"
    condition: "{response_value.feedback|exists} == True"
    # ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ exists Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ boolean, ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾
```

**ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾:** 
- **Ð”Ð»Ñ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ ÑÑ‚Ñ€Ð¾Ðº** â€” Ð²ÑÐµÐ³Ð´Ð° Ð¾Ð±Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ Ð² ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸: `'{_cache.field}' == 'value'`
- **Ð”Ð»Ñ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ Ñ‡Ð¸ÑÐµÐ»** â€” ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ñ‹: `{user_id} > 100`
- **Ð”Ð»Ñ boolean Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹** â€” ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ñ‹: `{field|exists} == True`

### Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð´Ð»Ñ ÑƒÑÐ»Ð¾Ð²Ð¸Ð¹:

**âš ï¸ Ð’Ð°Ð¶Ð½Ð¾:** Ð’ÑÐµ Ð¿Ð¾Ð»Ñ Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ… Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¸Ð¼ÐµÑ‚ÑŒ Ð¼Ð°Ñ€ÐºÐµÑ€ `$name` (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `$event_type`, `$user_id`, `$event_text`).

**Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:**
- **`$event_text`** â€” Ñ‚ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
- **`$event_type`** â€” Ñ‚Ð¸Ð¿ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ (message, callback)
- **`$user_id`** â€” ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
- **`$username`** â€” Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
- **`$chat_id`** â€” ID Ñ‡Ð°Ñ‚Ð°
- **`$callback_data`** â€” Ð´Ð°Ð½Ð½Ñ‹Ðµ callback ÐºÐ½Ð¾Ð¿ÐºÐ¸
- **`$event_date`** â€” Ð²Ñ€ÐµÐ¼Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
- **`$tenant_id`** â€” ID Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
- **`$message_id`** â€” ID ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
- **`$chat_type`** â€” Ñ‚Ð¸Ð¿ Ñ‡Ð°Ñ‚Ð°
- **`$is_group`** â€” ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð»Ð¸ Ñ‡Ð°Ñ‚ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð¹
- Ð˜ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð¾Ð»Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ (ÑÐ¼. [EVENT_GUIDE.md](EVENT_GUIDE.md))

**Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹:**
- **`$last_message_id`** â€” ID Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
- **`$response_data`** â€” Ð»ÑŽÐ±Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¼Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸
- **Ð”Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð¾Ð»Ñ** â€” Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð² ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸

**Ð’Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ:**
- **`$message.text`** â€” Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ð¼ Ð¿Ð¾Ð»ÑÐ¼ Ñ‡ÐµÑ€ÐµÐ· Ñ‚Ð¾Ñ‡ÐºÑƒ
- **`$user.profile.name`** â€” Ð¼Ð½Ð¾Ð³Ð¾ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²Ð°Ñ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ

### ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ…:

- **`==`** â€” Ñ€Ð°Ð²Ð½Ð¾
- **`!=`** â€” Ð½Ðµ Ñ€Ð°Ð²Ð½Ð¾
- **`>`**, **`<`**, **`>=`**, **`<=`** â€” ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ‡Ð¸ÑÐµÐ»
- **`in`**, **`not in`** â€” Ð²Ñ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº
- **`~`** â€” ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¿Ð¾Ð´ÑÑ‚Ñ€Ð¾ÐºÑƒ
- **`!~`** â€” Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¿Ð¾Ð´ÑÑ‚Ñ€Ð¾ÐºÑƒ
- **`regex`** â€” Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾Ðµ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ
- **`is_null`** â€” Ð¿Ð¾Ð»Ðµ Ð¿ÑƒÑÑ‚Ð¾Ðµ (None Ð¸Ð»Ð¸ Ð¿ÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°)
- **`not is_null`** â€” Ð¿Ð¾Ð»Ðµ Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ðµ (ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð¸ Ð¸Ð¼ÐµÐµÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ)

---

## â° Scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ (Ð·Ð°Ð¿ÑƒÑÐº Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐº ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ Ñ‡ÐµÑ€ÐµÐ· cron Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ.

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ:

```yaml
daily_report:
  description: "Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð² 9:00"
  
  # Cron Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 9:00
  schedule: "0 9 * * *"
  
  # Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹ - ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð±ÑƒÐ´ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ
  # ÐœÐ¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹ Ð´Ð»Ñ Ð³Ð¸Ð±Ñ€Ð¸Ð´Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð° (Ð¿Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼ Ð˜ Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ)
  
  step:
    - action: "send_message"
      params:
        target_chat_id: 123456789
        text: |
          ðŸ“Š Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚
          
          Ð’Ñ€ÐµÐ¼Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ°: {scheduled_at|format:datetime}
          Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹: {scheduled_scenario_name}
```

### Cron Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ:

**Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚:** `Ð¼Ð¸Ð½ÑƒÑ‚Ð° Ñ‡Ð°Ñ Ð´ÐµÐ½ÑŒ Ð¼ÐµÑÑÑ† Ð´ÐµÐ½ÑŒ_Ð½ÐµÐ´ÐµÐ»Ð¸`

| ÐŸÑ€Ð¸Ð¼ÐµÑ€ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|--------|----------|
| `* * * * *` | ÐšÐ°Ð¶Ð´ÑƒÑŽ Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ |
| `*/5 * * * *` | ÐšÐ°Ð¶Ð´Ñ‹Ðµ 5 Ð¼Ð¸Ð½ÑƒÑ‚ |
| `0 * * * *` | ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‡Ð°Ñ Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ Ñ‡Ð°ÑÐ° |
| `0 9 * * *` | ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 9:00 |
| `0 9 * * 1-5` | ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ Ð´ÐµÐ½ÑŒ Ð² 9:00 |
| `0 0 1 * *` | ÐŸÐµÑ€Ð²Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¼ÐµÑÑÑ†Ð° Ð² 00:00 |

**â„¹ï¸ Ð’Ð°Ð¶Ð½Ð¾:** Cron Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð¸Ð½Ñ‚ÐµÑ€Ð¿Ñ€ÐµÑ‚Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ Ð² **Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹**.

### Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð² scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ…:

Ð’ scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ… Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ. ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÐµÐ¹ ÑÐ¼. Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ [ÐŸÐ¾Ð»Ñ scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²](EVENT_GUIDE.md#Ð¿Ð¾Ð»Ñ-scheduled-ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²) Ð² EVENT_GUIDE.md.

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        â° Scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½
        
        Ð’Ñ€ÐµÐ¼Ñ: {scheduled_at|format:datetime}
        ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ: {scheduled_scenario_name}
        ID: {scheduled_scenario_id}
```

### Ð“Ð¸Ð±Ñ€Ð¸Ð´Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ (trigger + schedule):

Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¼Ð¾Ð¶ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¸ Ð¿Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼, Ð¸ Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾:

```yaml
hybrid_scenario:
  description: "Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¿Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼ Ð˜ Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ"
  
  # Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼
  trigger:
    - event_type: "message"
      event_text: "/report"
  
  # Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ð¾ Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸ÑŽ (ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð² 9:00)
  schedule: "0 9 * * *"
  
  step:
    - action: "send_message"
      params:
        text: |
          ðŸ“Š ÐžÑ‚Ñ‡ÐµÑ‚
          
          {scheduled_at|fallback:Ð—Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ|format:datetime}
```

### âš ï¸ Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð¸ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸:

**1. Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²:**
- ÐŸÑ€Ð¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² (ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¸ Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ) Ñ‚ÐµÑ€ÑÐµÑ‚ÑÑ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ (`last_scheduled_run`)
- ÐŸÐ¾ÑÐ»Ðµ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¿ÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÑŽÑ‚ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¾Ñ‚ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð°
- **Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ:** Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð² Ð¿ÐµÑ€Ð¸Ð¾Ð´Ñ‹ Ð½Ð¸Ð·ÐºÐ¾Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ scheduled Ð·Ð°Ð´Ð°Ñ‡

**2. ÐŸÑ€Ð¾Ð¿ÑƒÑÐº Ð·Ð°Ð¿ÑƒÑÐºÐ°:**
- Ð•ÑÐ»Ð¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð² Ð¼Ð¾Ð¼ÐµÐ½Ñ‚, ÐºÐ¾Ð³Ð´Ð° Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒÑÑ scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹, Ð·Ð°Ð¿ÑƒÑÐº Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½
- **Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ:** Ð˜Ð·Ð±ÐµÐ³Ð°Ð¹Ñ‚Ðµ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² Ð·Ð° Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÐµÐºÑƒÐ½Ð´ Ð´Ð¾ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐ°

**3. ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…:**
- Scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ Ð²Ñ€ÐµÐ¼Ñ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð´Ð°Ð¶Ðµ Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
- Ð­Ñ‚Ð¾ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·ÑƒÐµÐ¼Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¸ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð½Ñ‹Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²

**4. ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ:**
- Scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ (Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÑŽÑ‚ `bot_id`, `tenant_id`)
- **ÐžÐ±Ñ‰Ð¸Ðµ Ð¿Ð¾Ð»Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹:** Ð’ scheduled ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ… Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ð¾ Ð¾Ð±Ñ‰Ð¸Ñ… Ð¿Ð¾Ð»ÐµÐ¹ (`user_id`, `chat_id`, `event_text`, `message_id` Ð¸ Ð´Ñ€.) Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹, Ñ‚Ð°Ðº ÐºÐ°Ðº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð½Ðµ ÑÐ²ÑÐ·Ð°Ð½Ð¾ Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ Ð¸Ð»Ð¸ Ñ‡Ð°Ñ‚Ð¾Ð¼
- **ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²:** ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð² Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÑ… Ð¸Ð»Ð¸ Ð¸Ð·Ð²Ð»ÐµÐºÐ°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· storage Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (Ð¸Ð· Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…)
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `target_chat_id` Ð² Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð´Ð»Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ Ñ‡Ð°Ñ‚Ð°

---

## âš¡ Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (step)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹, Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ñ… Ð² ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸.

**Ð’Ð°Ð¶Ð½Ð¾:** 
- ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑˆÐ°Ð³Ð¾Ð² Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ÑÑ Ð¸Ñ… Ð¿Ð¾Ð·Ð¸Ñ†Ð¸ÐµÐ¹ Ð² Ð¼Ð°ÑÑÐ¸Ð²Ðµ `step` (ÑÐ²ÐµÑ€Ñ…Ñƒ Ð²Ð½Ð¸Ð·). Ð¨Ð°Ð³Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð² Ñ‚Ð¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð¾Ð½Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ð² YAML. ÐÑƒÐ¼ÐµÑ€Ð°Ñ†Ð¸Ñ ÑˆÐ°Ð³Ð¾Ð² Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ 0.
- **ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ:** ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¸Ð´ÐµÑ‚ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ð¾ ÑˆÐ°Ð³Ð°Ð¼ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ð¾Ñ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ. Ð•ÑÐ»Ð¸ Ñƒ ÑˆÐ°Ð³Ð° Ð½ÐµÑ‚ `transition` Ð¸Ð»Ð¸ Ð½ÐµÑ‚ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÐµÐ³Ð¾ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð° Ð´Ð»Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ, Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ ÑˆÐ°Ð³Ñƒ.
- **Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ‚Ð¾ÐºÐ°:** ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹ (`transition`) Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‚ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ (Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ð´Ñ€ÑƒÐ³Ð¾Ð¼Ñƒ ÑˆÐ°Ð³Ñƒ, ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ, Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¸ Ñ‚.Ð´.).

### ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ:

**Inline ÐºÐ½Ð¾Ð¿ÐºÐ¸:**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚!
        
        ðŸ“‹ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:
      inline:
        - [{"ðŸ“‹ ÐœÐµÐ½ÑŽ": "main_menu"}, {"ðŸ“š Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ°": "help"}]
        - [{"ðŸŒ Ð¡Ð°Ð¹Ñ‚": "https://example.com"}, {"ðŸ“ž ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°": "tg://resolve?domain=support"}]
        - [{"ðŸ”™ ÐÐ°Ð·Ð°Ð´": "start"}]
```

**Reply ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð°:**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚!
        
        ðŸ“‹ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:
      reply:
        - ["ðŸ“‹ ÐœÐµÐ½ÑŽ", "ðŸ“š Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ°"]
        - ["ðŸ”™ ÐÐ°Ð·Ð°Ð´"]
```

**Ð£Ð±Ñ€Ð°Ñ‚ÑŒ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ:**
```yaml
step:
  - action: "send_message"
    params:
      text: "ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° ÑƒÐ±Ñ€Ð°Ð½Ð°"
      reply: []  # ÐŸÑƒÑÑ‚Ð¾Ð¹ Ð¼Ð°ÑÑÐ¸Ð² ÑƒÐ±Ð¸Ñ€Ð°ÐµÑ‚ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ
```

### ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ:

- **`text`** â€” Ñ‚ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ (Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð¼Ð½Ð¾Ð³Ð¾ÑÑ‚Ñ€Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ñ `|`)
- **`inline`** â€” Ð¼Ð°ÑÑÐ¸Ð² ÐºÐ½Ð¾Ð¿Ð¾Ðº:
  - `[{"Ð¢ÐµÐºÑÑ‚ ÐºÐ½Ð¾Ð¿ÐºÐ¸": "callback_data"}]` â€” Ð¾Ð´Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ° Ð² ÑÑ‚Ñ€Ð¾ÐºÐµ
  - `[{"ÐšÐ½Ð¾Ð¿ÐºÐ° 1": "data1"}, {"ÐšÐ½Ð¾Ð¿ÐºÐ° 2": "data2"}]` â€” Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð² ÑÑ‚Ñ€Ð¾ÐºÐµ
  - `[{"Ð¡ÑÑ‹Ð»ÐºÐ°": "https://example.com"}]` â€” ÐºÐ½Ð¾Ð¿ÐºÐ° ÑÐ¾ ÑÑÑ‹Ð»ÐºÐ¾Ð¹
- **`reply`** â€” reply ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð°:
  - `[["ÐšÐ½Ð¾Ð¿ÐºÐ° 1", "ÐšÐ½Ð¾Ð¿ÐºÐ° 2"]]` â€” Ð¾Ð´Ð½Ð° ÑÑ‚Ñ€Ð¾ÐºÐ° ÐºÐ½Ð¾Ð¿Ð¾Ðº
  - `[["ÐšÐ½Ð¾Ð¿ÐºÐ° 1"], ["ÐšÐ½Ð¾Ð¿ÐºÐ° 2"]]` â€” ÐºÐ°Ð¶Ð´Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ° Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐµ
  - `[]` â€” ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ
- **`attachment`** â€” Ð¼Ð°ÑÑÐ¸Ð² Ð²Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹ (Ñ„Ð¾Ñ‚Ð¾, Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹, Ð²Ð¸Ð´ÐµÐ¾, Ð°ÑƒÐ´Ð¸Ð¾):
  - `[{"file_id": "AgACAgI...", "type": "photo"}]` â€” Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° Ð¿Ð¾ file_id
  - `[{"file_id": "{event_attachment[0].file_id}", "type": "{event_attachment[0].type}"}]` â€” Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ° Ð¸Ð· ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
  - `[{...}, {...}]` â€” Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð·Ð° Ñ€Ð°Ð·

### ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð²:

**ðŸ“Ž ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ðº ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÐ¼:**

ÐœÐ¾Ð¶Ð½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ñ„Ð¾Ñ‚Ð¾, Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹, Ð²Ð¸Ð´ÐµÐ¾, Ð°ÑƒÐ´Ð¸Ð¾. Ð¤Ð°Ð¹Ð»Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð¸Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ file_id.

**ÐŸÑ€Ð¸Ð¼ÐµÑ€: ÐŸÐµÑ€ÐµÑÑ‹Ð»ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° Ð¸Ð· ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:**
```yaml
step:
  - action: "send_message"
    params:
      text: "ÐŸÐµÑ€ÐµÑÑ‹Ð»Ð°ÑŽ Ð²Ð°Ñˆ Ñ„Ð°Ð¹Ð» Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾"
      attachment:
        - file_id: "{event_attachment[0].file_id}"
          type: "{event_attachment[0].type}"
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€: ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° Ð¿Ð¾ Ð¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾Ð¼Ñƒ file_id:**
```yaml
step:
  - action: "send_message"
    params:
      text: "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ"
      attachment:
        - file_id: "AgACAgIAAxkBAAIUJWjyLorr_d8Jwof3V_gVjVNdGHyXAAJ--zEb4vGQS-a9UiGzpkTNAQADAgADeQADNgW"
          type: "photo"
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€: ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ„Ð°Ð¹Ð»Ð¾Ð²:**
```yaml
step:
  - action: "send_message"
    params:
      text: "ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹"
      attachment:
        - file_id: "{event_attachment[0].file_id}"
          type: "{event_attachment[0].type}"
        - file_id: "BQACAgIAAxkBAAI..."
          type: "document"
```

**ðŸ“‹ ÐšÐ°Ðº Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ file_id Ð¸ type:** ÑÐ¼. [Ð¿Ñ€Ð¸Ð¼ÐµÑ€ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ð½Ð¸Ð¶Ðµ](#Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ-Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸-Ð¾-Ñ„Ð°Ð¹Ð»Ðµ) ðŸ‘‡

### ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° Ð² Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÑ…:

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° Ð² Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÑ….

ÐÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¸Ð· ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° (`_config`). Ð¢Ð°ÐºÐ¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ²Ð½Ð¾ Ð² `params` â€” Ð¾Ð½Ð¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð±ÐµÑ€ÑƒÑ‚ÑÑ Ð¸Ð· `_config`.

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:**

```yaml
step:
  - action: "completion"
    params:
      prompt: "ÐŸÑ€Ð¸Ð²ÐµÑ‚, ÐºÐ°Ðº Ð´ÐµÐ»Ð°?"
      # openrouter_token Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð±ÐµÑ€ÐµÑ‚ÑÑ Ð¸Ð· _config.openrouter_token
      # ÐÐµ Ð½ÑƒÐ¶Ð½Ð¾ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ openrouter_token ÑÐ²Ð½Ð¾!
```

**Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹:**

ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹:

```yaml
step:
  - action: "send_message"
    params:
      text: |
        ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°:
        Ð¢Ð¾ÐºÐµÐ½: {_config.openrouter_token|fallback:ÐÐµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½}
```

**Ð’Ð°Ð¶Ð½Ð¾:**
- `_config` Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð²Ð¾ Ð²ÑÐµÑ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ… Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
- Ð•ÑÐ»Ð¸ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°, Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð±ÑƒÐ´ÐµÑ‚ `None`
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `fallback` Ð² Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°Ñ… Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹
- Ð•ÑÐ»Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½ ÑÐ²Ð½Ð¾ Ð² `params`, ÑÐ²Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¸Ð¼ÐµÐµÑ‚ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚

ðŸ“– **ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ Ð¾ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°:** Ð¡Ð¼. Ñ€Ð°Ð·Ð´ÐµÐ» [config.yaml](TENANT_CONFIG_GUIDE.md#-configyaml) Ð² TENANT_CONFIG_GUIDE.md

### ÐšÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ…:

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð² `_cache` Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… ÑˆÐ°Ð³Ð°Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ.

**âš ï¸ Ð’Ð°Ð¶Ð½Ð¾: ÐžÐ±Ð»Ð°ÑÑ‚ÑŒ Ð²Ð¸Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸ ÐºÑÑˆÐ°:**
- ÐšÑÑˆ `_cache` ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ **Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð¹ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²** (Ð¾Ð´Ð½Ð° Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾Ð´Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ)
- Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð¼ÐµÐ¶Ð´Ñƒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÐ¼Ð¸ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð¹ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ðµ Ñ‡ÐµÑ€ÐµÐ· `jump_to_scenario` Ð¸Ð»Ð¸ `execute_scenario`)
- **ÐšÑÑˆ ÐÐ• ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ** Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ°Ð¼Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ (Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð¾Ð½Ð¸ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ÑÑ‚ÑÑ Ð¾Ð´Ð½Ð¸Ð¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÐµÐ¼ â€” ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¸Ð¼ÐµÐµÑ‚ ÑÐ²Ð¾Ð¹ Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÐºÑÑˆ)
- **ÐšÑÑˆ ÐÐ• ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ** Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼Ð¸ (Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÐ¼Ð¸, Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ callback'Ð°Ð¼Ð¸)
- Ð”Ð»Ñ Ð´Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `set_storage` / `set_user_storage` Ð²Ð¼ÐµÑÑ‚Ð¾ `set_cache`
- ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ ÑÐ¼. Ñ€Ð°Ð·Ð´ÐµÐ» [Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ](#ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ-ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°-Ð²-Ñ€Ð°Ð¼ÐºÐ°Ñ…-Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸-ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ)

**ÐžÐ±Ñ‰Ð°Ñ Ð¼ÐµÑ…Ð°Ð½Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:**
- ÐšÐ°Ð¶Ð´Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ `response_data` Ñ Ð»ÑŽÐ±Ñ‹Ð¼Ð¸ Ð¿Ð¾Ð»ÑÐ¼Ð¸
- Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² `_cache` Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÑ… Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹
- Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð´Ð²Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ñ… Ð¿Ð¾Ð»Ñ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…:
  - **`_namespace`** â€” Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÐ¸ Ð¸ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
  - **`_response_key`** â€” Ð´Ð»Ñ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñ‹ ÐºÐ»ÑŽÑ‡Ð° replaceable Ð¿Ð¾Ð»Ñ Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð² `_cache`
- Ð’ÑÐµ Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð´Ð²Ð¸Ð¶ÐºÐ° ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² Ð¸ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð² ÑÐµÑ€Ð²Ð¸ÑÐ°Ñ…

#### ÐŸÐ»Ð¾ÑÐºÐ¾Ðµ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ):

ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¿Ð»Ð¾ÑÐºÐ¾Ðµ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ â€” Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¼ÐµÑ€Ð¶Ð°Ñ‚ÑÑ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð² `_cache` Ð±ÐµÐ· Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸. Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼ Ð¾ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð»ÑÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· `{_cache.field}`:

```yaml
step:
  - action: "generate_int"
    params:
      min: 1
      max: 100
    # response_data: {"random_value": 42, "random_seed": 123}
    # ÐŸÐ¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²: _cache.random_value = 42, _cache.random_seed = 123
  
  - action: "send_message"
    params:
      text: "Ð§Ð¸ÑÐ»Ð¾: {_cache.random_value}"  # âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ð¼Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸:**

```yaml
step:
  - action: "generate_int"
    params:
      min: 1
      max: 100
    # _cache.random_value = 42, _cache.random_seed = 123
  
  - action: "generate_array"
    params:
      min: 1
      max: 10
      count: 5
    # _cache.random_list = [3, 7, 2, 9, 1], _cache.random_seed = 456
  
  - action: "send_message"
    params:
      text: |
        Ð§Ð¸ÑÐ»Ð¾: {_cache.random_value}
        ÐœÐ°ÑÑÐ¸Ð²: {_cache.random_list|comma}
```

**âš ï¸ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¿Ð»Ð¾ÑÐºÐ¾Ð³Ð¾ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:**

**1. ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ñ‹ Ð¸Ð¼ÐµÐ½ Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸:**
```yaml
step:
  - action: "get_storage_value"
    params:
      group_key: "settings"
      key: "api_key"
    # _cache.response_value = "key1"
  
  - action: "get_user_storage_value"
    params:
      key: "api_secret"
    # _cache.response_value = "secret1"  # âš ï¸ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÐ°Ð½Ð¾!
  
  - action: "send_message"
    params:
      text: "Key: {_cache.response_value}"  # ÐŸÐ¾ÐºÐ°Ð¶ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ "secret1"
```

**2. ÐŸÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÑŒ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ñ… Ð²Ñ‹Ð·Ð¾Ð²Ð°Ñ… Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ:**
```yaml
step:
  - action: "get_storage_value"
    params:
      group_key: "settings"
      key: "api_key"
    # _cache.response_value = "key1"
  
  - action: "get_storage_value"  # Ð¢Ð¾ Ð¶Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ!
    params:
      group_key: "settings"
      key: "api_secret"
    # _cache.response_value = "secret1"  # âš ï¸ ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÐ°Ð½!
```

#### Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ `_namespace` (ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÐ¸):

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½ÑƒÑŽ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ `_cache[_namespace]` Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÐ¸ Ð¸ Ð¸Ð·Ð±ÐµÐ¶Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð² Ð¸Ð¼ÐµÐ½.

**ÐœÐµÑ…Ð°Ð½Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:**
- Ð•ÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½ `_namespace`, Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² `_cache[_namespace]` Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¿Ð»Ð¾ÑÐºÐ¾Ð³Ð¾ `_cache`
- Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼: `{_cache[_namespace].field}`
- ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ñ… Ð²Ñ‹Ð·Ð¾Ð²Ð¾Ð² Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð² Ð¸Ð¼ÐµÐ½ Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:**

```yaml
step:
  - action: "generate_int"
    params:
      min: 1
      max: 100
      _namespace: "my_random"
    # ÐŸÐ¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²: _cache.my_random = {random_value: 42, random_seed: 123}
  
  - action: "send_message"
    params:
      text: "Ð§Ð¸ÑÐ»Ð¾: {_cache.my_random.random_value}"  # âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð² Ñ `_namespace`:**

```yaml
step:
  - action: "get_storage_value"
    params:
      group_key: "settings"
      key: "api_key"
      _namespace: "first"
    # _cache.first.response_value = "key1"
  
  - action: "get_storage_value"
    params:
      group_key: "settings"
      key: "api_secret"
      _namespace: "second"
    # _cache.second.response_value = "secret1"
    # âœ… ÐžÐ±Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹!
  
  - action: "send_message"
    params:
      text: |
        ÐŸÐµÑ€Ð²Ñ‹Ð¹: {_cache.first.response_value}
        Ð’Ñ‚Ð¾Ñ€Ð¾Ð¹: {_cache.second.response_value}
```

#### Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ `_response_key` (Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»Ñ):

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð´Ð°Ñ‚ÑŒ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ðµ Ð¸Ð¼Ñ Ð´Ð»Ñ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼ Ð² `_cache`.

**ÐœÐµÑ…Ð°Ð½Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:**
- ÐÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÑŽÑ‚ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ñ‹Ð¼ ÐºÐ»ÑŽÑ‡Ð¾Ð¼ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `storage_values`, `user_storage_values`, `formatted_text`)
- ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² `_cache` Ñ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼ ÐºÐ»ÑŽÑ‡Ð¾Ð¼ Ð¸Ð· Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- Ð•ÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½ `_response_key`, Ð´Ð²Ð¸Ð¶Ð¾Ðº Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ñ‹Ð²Ð°ÐµÑ‚ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð² `_cache`
- Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‚ Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»Ñ

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:**

```yaml
step:
  # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ storage Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð±ÑƒÐ´ÐµÑ‚ Ð² _cache.storage_values)
  - action: "get_storage"
    params:
      tenant_id: "{tenant_id}"
      group_key: "settings"
      key: "api_key"
      _response_key: "api_key"  # ÐŸÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ñ‹Ð²Ð°ÐµÐ¼ storage_values Ð² api_key
    # response_data: {"storage_values": "secret_key_123"}
    # ÐŸÐ¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²: _cache.api_key = "secret_key_123" (Ð²Ð¼ÐµÑÑ‚Ð¾ _cache.storage_values)
  
  # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ
  - action: "send_message"
    params:
      text: "API ÐºÐ»ÑŽÑ‡: {_cache.api_key}"  # âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ð¼Ð¸ Ð²Ñ‹Ð·Ð¾Ð²Ð°Ð¼Ð¸ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ:**

```yaml
step:
  # ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð²Ñ‹Ð·Ð¾Ð² - ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð² api_key
  - action: "get_storage"
    params:
      tenant_id: "{tenant_id}"
      group_key: "settings"
      key: "api_key"
      _response_key: "api_key"
    # _cache.api_key = "secret_key_123"
  
  # Ð’Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð²Ñ‹Ð·Ð¾Ð² - ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð² api_secret
  - action: "get_storage"
    params:
      tenant_id: "{tenant_id}"
      group_key: "settings"
      key: "api_secret"
      _response_key: "api_secret"
    # _cache.api_secret = "secret_secret_456"
    # âœ… ÐžÐ±Ð° Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð¿Ð¾Ð´ ÑƒÐ´Ð¾Ð±Ð½Ñ‹Ð¼Ð¸ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸!
  
  - action: "send_message"
    params:
      text: |
        API Key: {_cache.api_key}
        API Secret: {_cache.api_secret}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ñ‚ÐµÐºÑÑ‚Ð°:**

```yaml
step:
  # Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð´ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¼ ÐºÐ»ÑŽÑ‡Ð¾Ð¼
  - action: "format_data_to_text"
    params:
      format_type: "list"
      title: "Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð½Ð°Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ:"
      item_template: '- "$id" - $description'
      input_data: "{storage_values.ai_router.intents}"
      _response_key: "formatted_intents"
    # response_data: {"formatted_text": "â€¢ intent1\nâ€¢ intent2"}
    # ÐŸÐ¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²: _cache.formatted_intents = "â€¢ intent1\nâ€¢ intent2"
    # (Ð²Ð¼ÐµÑÑ‚Ð¾ _cache.format_data_to_text.formatted_text)
  
  - action: "send_message"
    params:
      text: "{_cache.formatted_intents}"  # âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑƒÐ´Ð¾Ð±Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
```

#### ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ñ `_namespace` Ð¸ `_response_key`:

```yaml
step:
  # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¸ _namespace, Ð¸ _response_key Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾
  - action: "get_storage"
    params:
      tenant_id: "{tenant_id}"
      group_key: "settings"
      key: "api_key"
      _namespace: "first"
      _response_key: "api_key"
    # _cache.first.api_key = "secret_key_123"
    # (Ð²Ð¼ÐµÑÑ‚Ð¾ _cache.first.storage_values)
  
  - action: "get_storage"
    params:
      tenant_id: "{tenant_id}"
      group_key: "settings"
      key: "api_secret"
      _namespace: "second"
      _response_key: "api_secret"
    # _cache.second.api_secret = "secret_secret_456"
  
  - action: "send_message"
    params:
      text: |
        ÐŸÐµÑ€Ð²Ñ‹Ð¹: {_cache.first.api_key}
        Ð’Ñ‚Ð¾Ñ€Ð¾Ð¹: {_cache.second.api_secret}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Ñ‚ÐµÐºÑÑ‚Ð°:**

```yaml
step:
  # Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ð¾Ð´ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¼ ÐºÐ»ÑŽÑ‡Ð¾Ð¼
  - action: "format_data_to_text"
    params:
      format_type: "list"
      title: "Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð½Ð°Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ:"
      item_template: '- "$id" - $description'
      input_data: "{storage_values.ai_router.intents}"
      _response_key: "formatted_intents"
    # response_data: {"formatted_text": "â€¢ intent1\nâ€¢ intent2"}
    # ÐŸÐ¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð²: _cache.formatted_intents = "â€¢ intent1\nâ€¢ intent2"
    # (Ð²Ð¼ÐµÑÑ‚Ð¾ _cache.format_data_to_text.formatted_text)
  
  - action: "send_message"
    params:
      text: "{_cache.formatted_intents}"  # âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑƒÐ´Ð¾Ð±Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
```

#### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ:

**ÐžÐ±Ñ‰Ð¸Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸:**
- âœ… ÐŸÐ»Ð¾ÑÐºÐ¾Ðµ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ â€” Ð¼ÐµÐ½ÑŒÑˆÐµ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸, Ð¿Ñ€Ð¾Ñ‰Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `_namespace` Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑÐ¸ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ñ… Ð²Ñ‹Ð·Ð¾Ð²Ð°Ñ… Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `_namespace` Ð´Ð»Ñ Ð¸Ð·Ð±ÐµÐ¶Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð² Ð¸Ð¼ÐµÐ½ Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `_response_key` Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ð¼ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑÐ¼ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹
- âœ… ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ `_namespace` Ð¸ `_response_key` Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð½Ð°Ð´ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² `_cache`
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¾ÑÐ¼Ñ‹ÑÐ»ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð¼ÐµÐ½Ð° Ð´Ð»Ñ `_namespace` Ð¸ `_response_key`
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `set_cache` Ð´Ð»Ñ Ð²Ñ‹Ð½Ð¾ÑÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð²Ð¾ Ñ„Ð»ÑÑ‚ Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸

**âš ï¸ Ð’Ð°Ð¶Ð½Ð¾:**
- `_response_key` Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‚ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñƒ ÐºÐ»ÑŽÑ‡Ð° Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
- Ð•ÑÐ»Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñƒ ÐºÐ»ÑŽÑ‡Ð°, `_response_key` Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ (Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±ÐºÐ¸)
- ÐŸÐ¾Ð´Ð¼ÐµÐ½Ð° Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿ÐµÑ€ÐµÐ´ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð² `_cache`

### Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:

**âš ï¸ Ð’Ð°Ð¶Ð½Ð¾:** ÐšÑÑˆ `_cache` ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ **Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð¹ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²**. Ð­Ñ‚Ð¾ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð¼ÐµÐ¶Ð´Ñƒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÐ¼Ð¸ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð¹ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸ (ÐºÐ¾Ð³Ð´Ð° Ð¾Ð´Ð¸Ð½ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ Ðº Ð´Ñ€ÑƒÐ³Ð¾Ð¼Ñƒ Ñ‡ÐµÑ€ÐµÐ· `jump_to_scenario` Ð¸Ð»Ð¸ `execute_scenario`), Ð½Ð¾ **Ð½Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ** Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ°Ð¼Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ (Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ Ð¾Ð½Ð¸ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ÑÑ‚ÑÑ Ð¾Ð´Ð½Ð¸Ð¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÐµÐ¼) Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼Ð¸.

**Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ "Ð¾Ð´Ð½Ð° Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ":**
- ÐžÐ´Ð½Ð° Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ° = Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ², ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð°Ð¼Ð¸ (`jump_to_scenario`, `execute_scenario`)
- Ð•ÑÐ»Ð¸ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ A Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ Ðº ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ B Ñ‡ÐµÑ€ÐµÐ· `jump_to_scenario` â€” ÑÑ‚Ð¾ Ð¾Ð´Ð½Ð° Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ°, ÐºÑÑˆ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ
- Ð•ÑÐ»Ð¸ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ A Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ B Ñ‡ÐµÑ€ÐµÐ· `execute_scenario` â€” ÑÑ‚Ð¾ Ð¾Ð´Ð½Ð° Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ°, ÐºÑÑˆ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ
- Ð•ÑÐ»Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ñ‹Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ² â€” ÑÑ‚Ð¾ Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸, Ñƒ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÐ²Ð¾Ð¹ Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÐºÑÑˆ

**Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ "Ð¾Ð´Ð½Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ":**
- ÐžÐ´Ð½Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ = Ð¾Ð´Ð½Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, Ð¾Ð´Ð¸Ð½ callback Ð¾Ñ‚ ÐºÐ½Ð¾Ð¿ÐºÐ¸, Ð¾Ð´Ð¸Ð½ scheduled Ð·Ð°Ð¿ÑƒÑÐº Ð¸ Ñ‚.Ð´.
- Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ `/start` â€” ÑÑ‚Ð¾ Ð¾Ð´Ð½Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
- Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð¶Ð°Ð» ÐºÐ½Ð¾Ð¿ÐºÑƒ Ñ `callback_data: "menu"` â€” ÑÑ‚Ð¾ Ð´Ñ€ÑƒÐ³Ð¾Ðµ, Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
- ÐšÐ°Ð¶Ð´Ð¾Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ², Ð½Ð¾ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ ÑÐ¾ ÑÐ²Ð¾Ð¸Ð¼ ÐºÑÑˆÐµÐ¼

**Ð§Ñ‚Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:**
- Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ (event data: `user_id`, `chat_id`, `event_text` Ð¸ Ñ‚.Ð´.)
- Ð’ÑÐµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ (Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· `response_data` Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð¿Ð°Ð´Ð°ÑŽÑ‚ Ð² Ð¿Ð»Ð¾ÑÐºÐ¸Ð¹ `_cache` Ð¸Ð»Ð¸ `_cache[_namespace]` ÐµÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½ `_namespace`, Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñ‹ ÐºÐ»ÑŽÑ‡Ð° Ñ‡ÐµÑ€ÐµÐ· `_response_key`)
- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· `_cache` (ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ `set_cache` Ð¸Ð»Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ)
- Ð›ÑŽÐ±Ñ‹Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ

**ÐšÐ¾Ð³Ð´Ð° ÐºÑÑˆ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ (Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð¹ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ):**

**âœ… ÐŸÑ€Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ðµ Ñ‡ÐµÑ€ÐµÐ· `jump_to_scenario`:**
```yaml
# Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: main_scenario
step:
  - action: "set_cache"
    params:
      cache:
        selected_user: "@username"
  
  - action: "send_message"
    transition:
      - action_result: "success"
        transition_action: "jump_to_scenario"
        transition_value: "next_scenario"

# Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: next_scenario
# âœ… Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· main_scenario Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ (Ð¾Ð´Ð½Ð° Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ):
step:
  - action: "send_message"
    params:
      text: "ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: {_cache.set_cache.selected_user}"  # âœ… Ð”Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½
```

**ÐšÐ¾Ð³Ð´Ð° ÐºÑÑˆ ÐÐ• ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ:**

**âŒ ÐœÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÐ¼Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ÑÑ‚ÑÑ Ð¾Ð´Ð½Ð¸Ð¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÐµÐ¼:**
```yaml
# Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ: message "/start"

# Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: welcome_scenario (Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ÑÑ "/start")
step:
  - action: "set_cache"
    params:
      cache:
        welcome_sent: true

# Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: analytics_scenario (Ñ‚Ð¾Ð¶Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¸Ñ‚ÑÑ "/start", Ð½Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾!)
step:
  - action: "send_message"
    params:
      text: "Welcome sent: {_cache.set_cache.welcome_sent}"  # âŒ ÐÐ• Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾! Ð Ð°Ð·Ð½Ñ‹Ðµ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
```

**âŒ ÐœÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼Ð¸:**
```yaml
# Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ 1: ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» "/start"
step:
  - action: "set_cache"
    params:
      cache:
        step: 1

# Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ 2: ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» "/menu" (Ð´Ñ€ÑƒÐ³Ð¾Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ!)
step:
  - action: "send_message"
    params:
      text: "Step: {_cache.set_cache.step}"  # âŒ ÐÐ• Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾! Ð Ð°Ð·Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
```

---

## ðŸ”„ ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹ (transition)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ‚Ð¾ÐºÐ¾Ð¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ.

```yaml
step:
  - action: "validate"
    params:
      condition: "$user_role == 'admin'"
    transition:
      - action_result: "success"
        transition_action: "jump_to_scenario"
        transition_value: "admin_panel"      # ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ðº ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ Ð°Ð´Ð¼Ð¸Ð½ÐºÐ¸
      - action_result: "error"
        transition_action: "continue"         # ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ð¿Ð¾Ñ‚Ð¾Ðº Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
      - action_result: "timeout"
        transition_action: "break"           # ÐŸÑ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¿Ñ€Ð¸ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ðµ
      - action_result: "error"
        transition_action: "abort"           # ÐŸÑ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²ÑÑŽ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ Ð¿Ñ€Ð¸ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±ÐºÐµ
      - action_result: "system_failure"
        transition_action: "stop"            # ÐŸÑ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²ÑÑŽ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ñ€Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð¹ Ð¾ÑˆÐ¸Ð±ÐºÐµ
```

### Ð¢Ð¸Ð¿Ñ‹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð²:

- **`continue`** â€” Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹
- **`break`** â€” Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ
- **`abort`** â€” Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²ÑÑŽ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ)
- **`stop`** â€” Ð¿Ñ€ÐµÑ€Ð²Ð°Ñ‚ÑŒ Ð²ÑÑŽ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ (Ð²ÑÐµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸)
- **`move_steps`** â€” Ð¿ÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒÑÑ Ð½Ð° ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑˆÐ°Ð³Ð¾Ð² (Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾ = Ð²Ð¿ÐµÑ€ÐµÐ´, Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ = Ð½Ð°Ð·Ð°Ð´). ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `move_step: 1` Ð¿ÐµÑ€ÐµÐ¹Ð´ÐµÑ‚ Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ ÑˆÐ°Ð³Ñƒ, `move_step: 2` Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ 1 ÑˆÐ°Ð³ Ð¸ Ð¿ÐµÑ€ÐµÐ¹Ð´ÐµÑ‚ Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ
- **`jump_to_step`** â€” Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ ÑˆÐ°Ð³Ñƒ Ð¿Ð¾ Ð¸Ð½Ð´ÐµÐºÑÑƒ (ÑˆÐ°Ð³Ð¸ Ð½ÑƒÐ¼ÐµÑ€ÑƒÑŽÑ‚ÑÑ Ñ 0, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `jump_to_step: 5` Ð¿ÐµÑ€ÐµÐ¹Ð´ÐµÑ‚ Ðº ÑˆÐ°Ð³Ñƒ Ñ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ 5)
- **`jump_to_scenario`** â€” Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ð´Ñ€ÑƒÐ³Ð¾Ð¼Ñƒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ (Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾ break + Ð¿Ñ€Ñ‹Ð¶Ð¾Ðº, Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð´Ð°Ð»ÐµÐµ Ð½Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ)
- **`any`** â€” ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿ÐµÑ€Ð²Ñ‹Ð¼ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ð¾Ñ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ

**ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð²:**
- **`transition_value`** â€” Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½ Ð´Ð»Ñ `move_steps` (ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑˆÐ°Ð³Ð¾Ð²), `jump_to_step` (Ð¸Ð½Ð´ÐµÐºÑ ÑˆÐ°Ð³Ð°, Ð½Ð°Ñ‡Ð¸Ð½Ð°Ñ Ñ 0) Ð¸ `jump_to_scenario` (Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ)
- **ÐŸÐ¾Ð¸ÑÐº ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ** â€” ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð¸Ñ‰ÐµÑ‚ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð² Ñ‚Ð¾Ð¼ Ð¶Ðµ tenant'Ðµ
- **ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð²** â€” Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ `any` Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿ÐµÑ€Ð²Ñ‹Ð¼, Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ð¾Ñ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- **Ð•Ð´Ð¸Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´** â€” Ð²ÑÐµÐ³Ð´Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ð´Ð¸Ð½ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ð¸Ð· Ð²ÑÐµÑ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ñ…
- **Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð²** â€” ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ `any`, Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹ (`success`, `error`, `timeout` Ð¸ Ñ‚.Ð´.) Ð½Ðµ Ð±ÑƒÐ´ÑƒÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ñ‹
- **Ð Ð°Ð·Ð»Ð¸Ñ‡Ð¸Ðµ Ð¼ÐµÐ¶Ð´Ñƒ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð°Ð¼Ð¸**:
  - **`break`** â€” Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹, Ð´Ñ€ÑƒÐ³Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ) Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÑŽÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ
  - **`abort`** â€” Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð²ÑÑŽ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð²ÑÐµ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸), Ð½Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÐ¼ (Ð¸Ð· Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¾Ð²) Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ
  - **`stop`** â€” Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ñ€ÐµÐºÑ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð²Ð¾ Ð²ÑÐµÑ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ…, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ
  - **`jump_to_scenario`** â€” Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ Ðº Ð´Ñ€ÑƒÐ³Ð¾Ð¼Ñƒ (Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾ break + Ð¿Ñ€Ñ‹Ð¶Ð¾Ðº)

---

## ðŸ”§ ÐŸÐ»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹ (Placeholders)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ Ð² Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ².

### ÐœÐµÑ…Ð°Ð½Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:

**Ð’ÑÐµ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹ Ð² `params` Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°Ð¼Ð¸** Ð¿ÐµÑ€ÐµÐ´ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ. Ð­Ñ‚Ð¾ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚:

- **Ð’ÑÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð² `params`** â€” ÑÑ‚Ñ€Ð¾ÐºÐ¸, Ñ‡Ð¸ÑÐ»Ð°, Ð¼Ð°ÑÑÐ¸Ð²Ñ‹, Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ â€” Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ Ñ‡ÐµÑ€ÐµÐ· Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð¾Ð²
- **Ð’ÑÐµ ÑƒÑ€Ð¾Ð²Ð½Ð¸ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸** â€” Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð½Ð° Ð»ÑŽÐ±Ð¾Ð¼ ÑƒÑ€Ð¾Ð²Ð½Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ `params` (Ð² ÑÑ‚Ñ€Ð¾ÐºÐ°Ñ…, ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ñ… Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð², Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑÑ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²)
- **ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°** â€” Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑˆÐ°Ð³Ð° ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ð¿ÐµÑ€ÐµÐ´ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- **Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð´Ð°Ð½Ð½Ñ‹Ñ…** â€” ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ ÐºÐ°Ðº Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸

### Ð¡Ð¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð¾Ð²:

**ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð·Ð°Ð¼ÐµÐ½Ð°:**
```yaml
params:
  text: "ÐŸÑ€Ð¸Ð²ÐµÑ‚, {username}!"
  chat_id: "{user_id}"
```

**Ð¡ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð°Ð¼Ð¸:**
```yaml
params:
  text: "ÐŸÑ€Ð¸Ð²ÐµÑ‚, {username|fallback:Ð“Ð¾ÑÑ‚ÑŒ}!"
  price: "{amount|*0.9|format:currency}"
```

**Ð›Ð¸Ñ‚ÐµÑ€Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð² ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ°Ñ…:**
```yaml
params:
  text: "{'hello'|upper}"                      # HELLO (Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸ Ñ‡ÐµÑ€ÐµÐ· ÑÐ»Ð¾Ð²Ð°Ñ€ÑŒ)
  duration: "{'1d 2w'|seconds}"                # 1296000 (Ð»Ð¸Ñ‚ÐµÑ€Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ)
  calculation: "{'100'|+50}"                   # 150 (Ð»Ð¸Ñ‚ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð°Ñ€Ð¸Ñ„Ð¼ÐµÑ‚Ð¸ÐºÐ°)
  date_shift: "{'2024-12-25'|shift:+1 day}"   # 2024-12-26 (Ð»Ð¸Ñ‚ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð´Ð°Ñ‚Ð°)
  # Ð”Ð²Ð¾Ð¹Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð´Ð»Ñ ÑÑ‚Ñ€Ð¾Ðº Ñ Ð¾Ð´Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ð¼Ð¸ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ°Ð¼Ð¸
  text: "{"it's working"}"                     # it's working
  # Ð­ÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸
  text: "{'it\'s working'}"                    # it's working
```

**Ð’Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹:**
```yaml
params:
  text: "ÐžÑ‚Ð²ÐµÑ‚: {status|equals:{expected}|value:OK|fallback:BAD}"
```

### âš ï¸ Ð’Ð°Ð¶Ð½Ð¾: ÐšÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð² YAML Ð´Ð»Ñ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð¾Ð² Ñ regex

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** YAML Ð¿Ð¾-Ñ€Ð°Ð·Ð½Ð¾Ð¼Ñƒ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ escape-Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð² Ð¾Ð´Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ñ… Ð¸ Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ñ… ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ°Ñ…, Ñ‡Ñ‚Ð¾ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð´Ð»Ñ regex Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð¾Ð² Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¼Ð¸ ÑÐ»ÐµÑˆÐ°Ð¼Ð¸.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ **Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸** Ð´Ð»Ñ regex Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ð¾Ð² Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¼Ð¸ ÑÐ»ÐµÑˆÐ°Ð¼Ð¸ (`\s`, `\d`, `\w` Ð¸ Ñ‚.Ð´.).

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:**

```yaml
# âŒ ÐžÐ¨Ð˜Ð‘ÐšÐ - Ð² Ð¾Ð´Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ñ… ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ°Ñ… \\s Ð½Ðµ ÑÐºÑ€Ð°Ð½Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾
params:
  value: '{event_text|regex:^([^\\s]+)|lower}'  # \\s ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ \s (Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¹ ÑÐ»ÐµÑˆ + s), Ð° Ð½Ðµ Ð¿Ñ€Ð¾Ð±ÐµÐ»!

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ ÑÐºÑ€Ð°Ð½Ð¸Ñ€ÑƒÑŽÑ‚ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ ÑÐ»ÐµÑˆÐ¸
params:
  value: "{event_text|regex:^([^\\s]+)|lower}"  # \\s ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ \s (Ð¿Ñ€Ð¾Ð±ÐµÐ» Ð² regex)

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð´Ð»Ñ regex Ð±ÐµÐ· Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ñ… ÑÐ»ÐµÑˆÐµÐ¹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ðµ
params:
  tenant_id: '{user_state|regex:tenant_(\d+)}'  # Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ñ‚Ð°Ðº ÐºÐ°Ðº \d Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð´Ð²Ð¾Ð¹Ð½Ð¾Ð³Ð¾ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

# âœ… ÐŸÐ ÐÐ’Ð˜Ð›Ð¬ÐÐž - Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… regex Ñ Ð¾Ð´Ð½Ð¸Ð¼ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¼ ÑÐ»ÐµÑˆÐµÐ¼ Ñ‚Ð¾Ð¶Ðµ Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸
params:
  value: "{event_text|regex:\\s+([^\\s]+)$|lower}"  # \\s Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð°, \\s Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð°

# âœ… ÐžÐ‘Ð«Ð§ÐÐ«Ð• ÐŸÐ›Ð•Ð™Ð¡Ð¥ÐžÐ›Ð”Ð•Ð Ð« - Ð±ÐµÐ· Ñ€Ð°Ð·Ð½Ð¸Ñ†Ñ‹
params:
  text: "ÐŸÑ€Ð¸Ð²ÐµÑ‚, {username}!"     # Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
  text: 'ÐŸÑ€Ð¸Ð²ÐµÑ‚, {username}!'    # Ð¢Ð¾Ð¶Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
```

**ÐšÐ¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸:**
- **Regex Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹ Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¼Ð¸ ÑÐ»ÐµÑˆÐ°Ð¼Ð¸** â€” `{field|regex:pattern}` Ð³Ð´Ðµ pattern ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ `\s`, `\d`, `\w`, `\n`, `\t` Ð¸ Ñ‚.Ð´.
- **Ð’Ð°Ð¶Ð½Ð¾:** Ð’ Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ñ… ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ°Ñ… Ð½ÑƒÐ¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð²Ð¾Ð¹Ð½Ð¾Ðµ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ: `\\s` Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð°, `\\d` Ð´Ð»Ñ Ñ†Ð¸Ñ„Ñ€Ñ‹
- **ÐŸÑ€Ð¸Ð¼ÐµÑ€:** `"{event_text|regex:^([^\\s]+)|lower}"` â€” `\\s` ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ `\s` (Ð¿Ñ€Ð¾Ð±ÐµÐ» Ð² regex)

**ÐšÐ¾Ð³Ð´Ð° Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð´Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸:**
- **Regex Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹ Ð±ÐµÐ· Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ñ… ÑÐ»ÐµÑˆÐµÐ¹** â€” Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹ Ð±ÐµÐ· `\s`, `\d`, `\w` Ð¸ Ñ‚.Ð´.
- **ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ðµ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹** â€” `{username}`, `{user_id}`
- **ÐŸÑ€Ð¾ÑÑ‚Ñ‹Ðµ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹** â€” `{name|upper}`, `{price|format:currency}`
- **Ð¢ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ** â€” Ð±ÐµÐ· ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ñ… ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²

**ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾:** Ð•ÑÐ»Ð¸ Ð² regex Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ðµ ÐµÑÑ‚ÑŒ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ ÑÐ»ÐµÑˆÐ¸ (`\s`, `\d`, `\w` Ð¸ Ñ‚.Ð´.) â€” **Ð²ÑÐµÐ³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸** Ñ Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ð¼ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ (`\\s`, `\\d`, `\\w`).

**Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ð¼ Ð´Ð°Ð½Ð½Ñ‹Ð¼:**
```yaml
params:
  # Ð¢Ð¾Ñ‡ÐµÑ‡Ð½Ð°Ñ Ð½Ð¾Ñ‚Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²
  text: "ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: {user.profile.name|fallback:ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹}"
  text: "Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ: {message.text}"
  
  # Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð²
  text: "ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»: {attachment[0].file_id}"
  text: "ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: {users[-1].name}"
  
  # ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿
  text: "Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ: {event.attachment[0].type}"
  text: "Ð”Ð°Ð½Ð½Ñ‹Ðµ: {response.data.items[0].value}"
```

### Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:

**Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¸ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°Ñ…:**

**Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:**
- **`user_id`** â€” ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
- **`username`** â€” Ð¸Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ  
- **`chat_id`** â€” ID Ñ‡Ð°Ñ‚Ð°
- **`event_text`** â€” Ñ‚ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
- **`callback_data`** â€” Ð´Ð°Ð½Ð½Ñ‹Ðµ callback ÐºÐ½Ð¾Ð¿ÐºÐ¸
- **`event_date`** â€” Ð²Ñ€ÐµÐ¼Ñ Ð¸Ð²ÐµÐ½Ñ‚Ð°
- **`tenant_id`** â€” ID Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
- **`message_id`** â€” ID ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
- **`reply_to_message_id`** â€” ID ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, Ð½Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÐ¼
- **`forward_from`** â€” Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐµ
- **Ð˜ Ð»ÑŽÐ±Ñ‹Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð¾Ð»Ñ** â€” Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ñ‚Ð¸Ð¿Ð° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ

**ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°:**
- **`_config`** â€” ÑÐ»Ð¾Ð²Ð°Ñ€ÑŒ Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÐµÐ¹ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° (Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹ Ð¸Ð· `config.yaml`)
  - **`_config.openrouter_token`** â€” OpenRouter API ÐºÐ»ÑŽÑ‡ Ð´Ð»Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð° (ÐµÑÐ»Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½)
  - **Ð”Ñ€ÑƒÐ³Ð¸Ðµ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹** â€” Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
  - ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð²Ð¾ Ð²ÑÐµÑ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑÑ… Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°

**Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹:**
- **`last_message_id`** â€” ID Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
- **`response_data`** â€” Ð»ÑŽÐ±Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¼Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸
- **Ð”Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð¾Ð»Ñ** â€” Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð² ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸


### Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ð¼ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð°Ð¼:

> **Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼!** ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ñ‚Ð¾Ñ‡ÐµÑ‡Ð½Ð¾Ð¹ Ð½Ð¾Ñ‚Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² Ð¸ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð² Ð´Ð»Ñ Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð².

<table>
<thead>
<tr><th>Ð¡Ð¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ</th><th>ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ</th><th>ÐŸÑ€Ð¸Ð¼ÐµÑ€</th><th>Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚</th></tr>
</thead>
<tbody>
<tr><td colspan="4"><strong>ÐžÐ±ÑŠÐµÐºÑ‚Ñ‹</strong></td></tr>
<tr><td><code>object.field</code></td><td>Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð¿Ð¾Ð»ÑŽ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°</td><td><code>{message.text}</code></td><td><code>ÐŸÑ€Ð¸Ð²ÐµÑ‚ Ð¼Ð¸Ñ€</code></td></tr>
<tr><td><code>object.field.subfield</code></td><td>Ð’Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ</td><td><code>{user.profile.name}</code></td><td><code>Ð˜Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð²</code></td></tr>
<tr><td colspan="4"><strong>ÐœÐ°ÑÑÐ¸Ð²Ñ‹</strong></td></tr>
<tr><td><code>array[index]</code></td><td>Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñƒ Ð¼Ð°ÑÑÐ¸Ð²Ð°</td><td><code>{attachment[0].file_id}</code></td><td><code>file_1</code> (Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»)</td></tr>
<tr><td><code>array[-index]</code></td><td>ÐžÑ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½Ð´ÐµÐºÑ</td><td><code>{attachment[-1].file_id}</code></td><td><code>file_3</code> (Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ„Ð°Ð¹Ð»)</td></tr>
<tr><td><code>array[index].field</code></td><td>ÐŸÐ¾Ð»Ðµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð¼Ð°ÑÑÐ¸Ð²Ð°</td><td><code>{users[1].name}</code></td><td><code>Ð‘Ð¾Ð±</code> (Ð¸Ð¼Ñ Ð²Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ)</td></tr>
<tr><td><code>array[index][index]</code></td><td>Ð’Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ð¼Ð°ÑÑÐ¸Ð²Ñ‹</td><td><code>{matrix[0][1]}</code></td><td><code>2</code> (ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ Ð¼Ð°Ñ‚Ñ€Ð¸Ñ†Ñ‹)</td></tr>
<tr><td colspan="4"><strong>ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹</strong></td></tr>
<tr><td><code>object.array[index].field</code></td><td>Ð¡Ð¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿</td><td><code>{event.attachment[0].file_id}</code></td><td><code>file_1</code></td></tr>
</tbody>
</table>

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:**
```yaml
params:
  # ÐžÐ±ÑŠÐµÐºÑ‚Ñ‹
  text: "Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ: {message.text}"
  text: "ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: {user.profile.name|fallback:ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹}"
  
  # ÐœÐ°ÑÑÐ¸Ð²Ñ‹
  text: "ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»: {attachment[0].file_id}"
  text: "ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ: {users[-1].name|upper}"
  text: "Ð¤Ð°Ð¹Ð»: {attachment[0].file_id}, Ñ€Ð°Ð·Ð¼ÐµÑ€: {attachment[0].size}"
  
  # ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿
  text: "Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ: {event.attachment[0].type}"
  text: "Ð”Ð°Ð½Ð½Ñ‹Ðµ: {response.data.items[0].value}"
  
  # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
  text: "Ð¢Ð¾ÐºÐµÐ½: {_config.openrouter_token|fallback:ÐÐµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½}"
  
  # Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿
  text: "{attachment[10].file_id|fallback:Ð¤Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½}"
```

### ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾ Ñ„Ð°Ð¹Ð»Ðµ

**ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÑ€: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ file_id Ð¸ type Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð¾Ð²**

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ file_id Ð¸ type Ð²ÑÐµÑ… Ð²Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹ Ð¸Ð· ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ:

```yaml
file_info:
  description: "ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ file_id Ð¸ type Ð²Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ Ð¿Ð¾ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¹ Ð¿ÐµÑ€ÐµÑÑ‹Ð»ÐºÐ¸"
  trigger:
    - event_type: "message"
      event_text: "/file"

  step:
    - action: "send_message"
      params:
        text: |
          ðŸ“Ž Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ„Ð°Ð¹Ð»Ðµ:
          
          file_id: <code>{event_attachment[0].file_id|fallback:{reply_attachment[0].file_id|fallback:Ð¤Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½}}</code>
          type: <code>{event_attachment[0].type|fallback:{reply_attachment[0].type|fallback:Ð¢Ð¸Ð¿ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½}}</code>
```

**ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº:**
- ÐŸÑ€Ð¸ Ð¾Ð±Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¸ Ðº Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¼Ñƒ Ð¿Ð¾Ð»ÑŽ/Ð¸Ð½Ð´ÐµÐºÑÑƒ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ `None`
- ÐœÐ¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ `fallback` Ð´Ð»Ñ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
- ÐžÑ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ ÐºÐ°Ðº Ð² Python: `-1` = Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð½ÐµÐ¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ð°Ñ Ð³Ð»ÑƒÐ±Ð¸Ð½Ð° Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸

### ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹:

<table>
<thead>
<tr><th>ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€</th><th>ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ</th><th>ÐŸÑ€Ð¸Ð¼ÐµÑ€</th><th>Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚</th></tr>
</thead>
<tbody>
<tr><td colspan="4"><strong>ÐÑ€Ð¸Ñ„Ð¼ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸</strong></td></tr>
<tr><td><code>+value</code></td><td>Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ</td><td><code>{price|+100}</code></td><td><code>1500</code> (ÐµÑÐ»Ð¸ price=1400)</td></tr>
<tr><td><code>-value</code></td><td>Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ</td><td><code>{price|-50}</code></td><td><code>1350</code> (ÐµÑÐ»Ð¸ price=1400)</td></tr>
<tr><td><code>*value</code></td><td>Ð£Ð¼Ð½Ð¾Ð¶ÐµÐ½Ð¸Ðµ</td><td><code>{price|*0.9}</code></td><td><code>1260</code> (ÐµÑÐ»Ð¸ price=1400)</td></tr>
<tr><td><code>/value</code></td><td>Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ</td><td><code>{seconds|/3600}</code></td><td><code>2.5</code> (ÐµÑÐ»Ð¸ seconds=9000)</td></tr>
<tr><td><code>%value</code></td><td>ÐžÑÑ‚Ð°Ñ‚Ð¾Ðº Ð¾Ñ‚ Ð´ÐµÐ»ÐµÐ½Ð¸Ñ</td><td><code>{number|%7}</code></td><td><code>3</code> (ÐµÑÐ»Ð¸ number=10)</td></tr>
<tr><td colspan="4"><strong>Ð ÐµÐ³Ð¸ÑÑ‚Ñ€</strong></td></tr>
<tr><td><code>upper</code></td><td>Ð’ÐµÑ€Ñ…Ð½Ð¸Ð¹ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€</td><td><code>{name|upper}</code></td><td><code>Ð˜Ð’ÐÐ</code> (ÐµÑÐ»Ð¸ name="Ð˜Ð²Ð°Ð½")</td></tr>
<tr><td><code>lower</code></td><td>ÐÐ¸Ð¶Ð½Ð¸Ð¹ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€</td><td><code>{name|lower}</code></td><td><code>Ð¸Ð²Ð°Ð½</code> (ÐµÑÐ»Ð¸ name="Ð˜Ð²Ð°Ð½")</td></tr>
<tr><td><code>title</code></td><td>Ð—Ð°Ð³Ð»Ð°Ð²Ð½Ñ‹Ðµ Ð±ÑƒÐºÐ²Ñ‹ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÐ»Ð¾Ð²Ð°</td><td><code>{name|title}</code></td><td><code>Ð˜Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð²</code> (ÐµÑÐ»Ð¸ name="Ð¸Ð²Ð°Ð½ Ð¿ÐµÑ‚Ñ€Ð¾Ð²")</td></tr>
<tr><td><code>capitalize</code></td><td>ÐŸÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð³Ð»Ð°Ð²Ð½Ð°Ñ Ð±ÑƒÐºÐ²Ð°</td><td><code>{name|capitalize}</code></td><td><code>Ð˜Ð²Ð°Ð½</code> (ÐµÑÐ»Ð¸ name="Ð¸Ð²Ð°Ð½")</td></tr>
<tr><td><code>case:type</code></td><td>ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°</td><td><code>{name|case:upper}</code></td><td><code>Ð˜Ð’ÐÐ</code> (ÐµÑÐ»Ð¸ name="Ð˜Ð²Ð°Ð½")</td></tr>
<tr><td colspan="4"><strong>Ð¡Ð¿Ð¸ÑÐºÐ¸</strong></td></tr>
<tr><td><code>tags</code></td><td>ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² Ñ‚ÐµÐ³Ð¸</td><td><code>{users|tags}</code></td><td><code>@user1 @user2</code></td></tr>
<tr><td><code>list</code></td><td>ÐœÐ°Ñ€ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº</td><td><code>{items|list}</code></td><td><code>â€¢ item1\nâ€¢ item2</code></td></tr>
<tr><td><code>comma</code></td><td>Ð§ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ</td><td><code>{items|comma}</code></td><td><code>item1, item2</code></td></tr>
<tr><td><code>expand</code></td><td>Ð Ð°Ð·Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¼Ð°ÑÑÐ¸Ð²Ð° Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð² Ð½Ð° Ð¾Ð´Ð¸Ð½ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ð¼Ð°ÑÑÐ¸Ð²Ð°Ñ…)</td><td><code>{keyboard|expand}</code></td><td><code>[[a, b], [c]]</code> â†’ <code>[a, b], [c]</code> (Ð² Ð¼Ð°ÑÑÐ¸Ð²Ðµ)</td></tr>
<tr><td><code>keys</code></td><td>Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð¸Ð· Ð¾Ð±ÑŠÐµÐºÑ‚Ð° (ÑÐ»Ð¾Ð²Ð°Ñ€Ñ) Ð² Ð¼Ð°ÑÑÐ¸Ð²</td><td><code>{storage_values|keys}</code></td><td><code>["group1", "group2"]</code> (ÐµÑÐ»Ð¸ storage_values={"group1": {...}, "group2": {...}})</td></tr>
<tr><td colspan="4"><strong>ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ</strong></td></tr>
<tr><td><code>code</code></td><td>ÐžÐ±Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð² code Ð±Ð»Ð¾Ðº</td><td><code>{field|code}</code></td><td><code>&lt;code&gt;value&lt;/code&gt;</code></td></tr>
<tr><td colspan="4"><strong>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ</strong></td></tr>
<tr><td><code>truncate:length</code></td><td>ÐžÐ±Ñ€ÐµÐ·ÐºÐ° Ñ‚ÐµÐºÑÑ‚Ð°</td><td><code>{text|truncate:50}</code></td><td><code>ÐžÑ‡ÐµÐ½ÑŒ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚...</code></td></tr>
<tr><td><code>format:date</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ñ‚Ñ‹</td><td><code>{timestamp|format:date}</code></td><td><code>25.12.2024</code></td></tr>
<tr><td><code>format:time</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸</td><td><code>{timestamp|format:time}</code></td><td><code>14:30</code></td></tr>
<tr><td><code>format:time_full</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ñ ÑÐµÐºÑƒÐ½Ð´Ð°Ð¼Ð¸</td><td><code>{timestamp|format:time_full}</code></td><td><code>14:30:45</code></td></tr>
<tr><td><code>format:datetime</code></td><td>ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{timestamp|format:datetime}</code></td><td><code>25.12.2024 14:30</code></td></tr>
<tr><td><code>format:datetime_full</code></td><td>ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ ÑÐµÐºÑƒÐ½Ð´Ð°Ð¼Ð¸</td><td><code>{timestamp|format:datetime_full}</code></td><td><code>25.12.2024 14:30:45</code></td></tr>
<tr><td><code>format:pg_date</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ñ‚Ñ‹ Ð´Ð»Ñ PostgreSQL (YYYY-MM-DD)</td><td><code>{timestamp|format:pg_date}</code></td><td><code>2024-12-25</code></td></tr>
<tr><td><code>format:pg_datetime</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð°Ñ‚Ñ‹ Ð¸ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð´Ð»Ñ PostgreSQL (YYYY-MM-DD HH:MM:SS)</td><td><code>{timestamp|format:pg_datetime}</code></td><td><code>2024-12-25 14:30:45</code></td></tr>
<tr><td><code>seconds</code></td><td>ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… ÑÑ‚Ñ€Ð¾Ðº Ð² ÑÐµÐºÑƒÐ½Ð´Ñ‹ (Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°: Xw Yd Zh Km Ms)</td><td><code>{duration|seconds}</code></td><td><code>9000</code> (ÐµÑÐ»Ð¸ duration="2h 30m")</td></tr>
<tr><td><code>shift:Â±Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»</code></td><td>Ð¡Ð´Ð²Ð¸Ð³ Ð´Ð°Ñ‚Ñ‹ Ð½Ð° Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» (PostgreSQL style: +1 day, -2 hours, +1 year 2 months). ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð²ÑÐµÑ… Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¾Ð² Ð´Ð°Ñ‚, ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¼ÐµÑÑÑ†ÐµÐ²/Ð³Ð¾Ð´Ð¾Ð²</td><td><code>{created|shift:+1 day}</code></td><td><code>2024-12-26</code> (ÐµÑÐ»Ð¸ created="2024-12-25")</td></tr>
<tr><td colspan="4"><strong>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°</strong></td></tr>
<tr><td><code>to_date</code></td><td>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð´Ð½Ñ (00:00:00), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ISO Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{created|to_date}</code></td><td><code>2024-12-25 00:00:00</code></td></tr>
<tr><td><code>to_hour</code></td><td>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ñ‡Ð°ÑÐ° (Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ Ð¸ ÑÐµÐºÑƒÐ½Ð´Ñ‹ = 0), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ISO Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{created|to_hour}</code></td><td><code>2024-12-25 15:00:00</code> (ÐµÑÐ»Ð¸ created="2024-12-25 15:30:45")</td></tr>
<tr><td><code>to_minute</code></td><td>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ (ÑÐµÐºÑƒÐ½Ð´Ñ‹ = 0), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ISO Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{created|to_minute}</code></td><td><code>2024-12-25 15:30:00</code> (ÐµÑÐ»Ð¸ created="2024-12-25 15:30:45")</td></tr>
<tr><td><code>to_second</code></td><td>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ ÑÐµÐºÑƒÐ½Ð´Ñ‹ (Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÐºÑƒÐ½Ð´Ñ‹ = 0), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ISO Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{created|to_second}</code></td><td><code>2024-12-25 15:30:45</code></td></tr>
<tr><td><code>to_week</code></td><td>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð½ÐµÐ´ÐµÐ»Ð¸ (Ð¿Ð¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðº 00:00:00), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ISO Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{created|to_week}</code></td><td><code>2024-12-23 00:00:00</code> (ÐµÑÐ»Ð¸ created="2024-12-25 15:30:45")</td></tr>
<tr><td><code>to_month</code></td><td>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð¼ÐµÑÑÑ†Ð° (1 Ñ‡Ð¸ÑÐ»Ð¾, 00:00:00), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ISO Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{created|to_month}</code></td><td><code>2024-12-01 00:00:00</code> (ÐµÑÐ»Ð¸ created="2024-12-25 15:30:45")</td></tr>
<tr><td><code>to_year</code></td><td>ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð³Ð¾Ð´Ð° (1 ÑÐ½Ð²Ð°Ñ€Ñ, 00:00:00), Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ISO Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚</td><td><code>{created|to_year}</code></td><td><code>2024-01-01 00:00:00</code> (ÐµÑÐ»Ð¸ created="2024-12-25 15:30:45")</td></tr>
<tr><td><code>format:currency</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²Ð°Ð»ÑŽÑ‚Ñ‹</td><td><code>{amount|format:currency}</code></td><td><code>1000.00 â‚½</code></td></tr>
<tr><td><code>format:percent</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ð¾Ð²</td><td><code>{value|format:percent}</code></td><td><code>25.5%</code></td></tr>
<tr><td><code>format:number</code></td><td>Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‡Ð¸ÑÐµÐ»</td><td><code>{value|format:number}</code></td><td><code>1234.56</code></td></tr>
<tr><td><code>format:timestamp</code></td><td>ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð² timestamp</td><td><code>{date|format:timestamp}</code></td><td><code>1703512200</code></td></tr>
<tr><td colspan="4"><strong>Ð£ÑÐ»Ð¾Ð²Ð½Ñ‹Ðµ</strong></td></tr>
<tr><td><code>equals:value</code></td><td>ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð²ÐµÐ½ÑÑ‚Ð²Ð° (ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ð¾Ðµ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ)</td><td><code>{status|equals:active}</code></td><td><code>true</code> Ð¸Ð»Ð¸ <code>false</code></td></tr>
<tr><td><code>in_list:items</code></td><td>ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ñ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº</td><td><code>{role|in_list:admin,moderator}</code></td><td><code>true</code> Ð¸Ð»Ð¸ <code>false</code></td></tr>
<tr><td><code>true</code></td><td>ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ÑÑ‚Ð¸Ð½Ð½Ð¾ÑÑ‚Ð¸ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ boolean)</td><td><code>{is_active|true}</code></td><td><code>true</code> Ð¸Ð»Ð¸ <code>false</code></td></tr>
<tr><td><code>exists</code></td><td>ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ (Ð½Ðµ None Ð¸ Ð½Ðµ Ð¿ÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°)</td><td><code>{field|exists}</code></td><td><code>true</code> Ð¸Ð»Ð¸ <code>false</code></td></tr>
<tr><td><code>is_null</code></td><td>ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° null (None, Ð¿ÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° Ð¸Ð»Ð¸ ÑÑ‚Ñ€Ð¾ÐºÐ° "null")</td><td><code>{field|is_null}</code></td><td><code>true</code> Ð¸Ð»Ð¸ <code>false</code></td></tr>
<tr><td><code>value:result</code></td><td>Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð¸ÑÑ‚Ð¸Ð½Ð½Ð¾ÑÑ‚Ð¸</td><td><code>{status|equals:active|value:ÐÐºÑ‚Ð¸Ð²ÐµÐ½}</code></td><td><code>ÐÐºÑ‚Ð¸Ð²ÐµÐ½</code> Ð¸Ð»Ð¸ <code>null</code></td></tr>
<tr><td colspan="4"><strong>Ð¡Ð»ÑƒÐ¶ÐµÐ±Ð½Ñ‹Ðµ</strong></td></tr>
<tr><td><code>fallback:value</code></td><td>Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ</td><td><code>{username|fallback:Ð“Ð¾ÑÑ‚ÑŒ}</code></td><td><code>Ð˜Ð²Ð°Ð½</code> Ð¸Ð»Ð¸ <code>Ð“Ð¾ÑÑ‚ÑŒ</code></td></tr>
<tr><td><code>length</code></td><td>ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ Ð´Ð»Ð¸Ð½Ñ‹</td><td><code>{text|length}</code></td><td><code>15</code> (ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²)</td></tr>
<tr><td><code>length</code></td><td>ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ Ð´Ð»Ð¸Ð½Ñ‹ Ð¼Ð°ÑÑÐ¸Ð²Ð°</td><td><code>{array|length}</code></td><td><code>3</code> (ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²)</td></tr>
<tr><td><code>regex:pattern</code></td><td>Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ regex</td><td><code>{text|regex:(\d+)}</code></td><td><code>123</code> (Ð¿ÐµÑ€Ð²Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾)</td></tr>
<tr><td colspan="4"><strong>ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ</strong></td></tr>
<tr><td><code>ready</code></td><td>ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ</td><td><code>{_async_action.ai_req_1|ready}</code></td><td><code>true</code> ÐµÑÐ»Ð¸ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾, <code>false</code> ÐµÑÐ»Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ</td></tr>
<tr><td><code>not_ready</code></td><td>ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ ÐµÑ‰Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ</td><td><code>{_async_action.ai_req_1|not_ready}</code></td><td><code>true</code> ÐµÑÐ»Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ, <code>false</code> ÐµÑÐ»Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾</td></tr>
</tbody>
</table>

### ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ:

```yaml
params:
  # ÐŸÑ€Ð¾ÑÑ‚Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸
  result: "{value|+100|format:currency}"
  
  # Ð£ÑÐ»Ð¾Ð²Ð½Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ°
  status: "{user_status|equals:active|value:ÐÐºÑ‚Ð¸Ð²ÐµÐ½|fallback:ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½}"
  
  # Ð¦ÐµÐ¿Ð¾Ñ‡ÐºÐ° Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð¾Ð²
  formatted: "{price|*0.9|format:currency|fallback:0.00 â‚½}"
  
  # Regex Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð´Ð²Ð¾Ð¹Ð½Ñ‹Ðµ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ñ… ÑÐ»ÐµÑˆÐµÐ¹!)
  duration: "{event_text|regex:(\\d+)\\s*Ð¼Ð¸Ð½|fallback:0}"
  
  # Ð¢Ð¾Ñ‡ÐµÑ‡Ð½Ð°Ñ Ð½Ð¾Ñ‚Ð°Ñ†Ð¸Ñ
  name: "{user.profile.name|fallback:ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹}"
  
  # Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
  duration_seconds: "{duration|seconds}"
  duration_minutes: "{duration|seconds|/60}"
  duration_hours: "{duration|seconds|/3600}"
  formatted_time: "{duration|seconds|format:number}"
  
  # Ð¡Ð´Ð²Ð¸Ð³ Ð´Ð°Ñ‚
  tomorrow: "{created|shift:+1 day}"
  next_month: "{created|shift:+1 month|format:date}"
  complex_shift: "{created|shift:+1 year 2 months|format:datetime}"
  
  # ÐŸÑ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ðº Ð½Ð°Ñ‡Ð°Ð»Ñƒ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð°
  start_of_day: "{created|to_date}"
  start_of_week: "{created|to_week}"
  formatted_month_start: "{created|to_month|format:date}"
  
  # Boolean Ð¿Ð¾Ð»Ñ (Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð°ÐµÐ¼ True/False/None)
  is_active: "{is_active|equals:True|value:âœ… Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½|fallback:{is_active|equals:False|value:âŒ Ð’Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½|fallback:â“ ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾}}"
  is_polling: "{is_polling|equals:True|value:âœ… ÐÐºÑ‚Ð¸Ð²ÐµÐ½|fallback:{is_polling|equals:False|value:âŒ ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½|fallback:â“ ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾}}"
  
  # String Ð¿Ð¾Ð»Ñ (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ equals:value)
  status: "{user_status|equals:active|value:ÐÐºÑ‚Ð¸Ð²ÐµÐ½|fallback:ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½}"
  
  # Ð£Ð¿Ñ€Ð¾Ñ‰ÐµÐ½Ð½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ (ÐµÑÐ»Ð¸ None Ð½Ðµ Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ÑÑ)
  is_simple: "{is_active|true|value:âœ… Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½|fallback:âŒ Ð’Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½}"
  
  # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ (Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ…)
  # Ð’ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ: {field|exists} == True Ð¸Ð»Ð¸ {field|exists} == False
  
  # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð° null (Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ…)
  # Ð’ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ: {field|is_null} == True Ð¸Ð»Ð¸ {field|is_null} == False
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ exists Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ…:**

```yaml
step:
  - action: "validate"
    params:
      condition: "{response_value.feedback|exists} == True"
    transition:
      - action_result: "success"
        transition_action: "continue"  # Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
      - action_result: "failed"
        transition_action: "jump_to_scenario"
        transition_value: "create_feedback"  # Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
```

### Ð’Ð°Ð¶Ð½Ð¾: boolean vs string Ð¿Ð¾Ð»Ñ

**Ð”Ð»Ñ boolean Ð¿Ð¾Ð»ÐµÐ¹ (True/False):**
- **Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ:** `{is_active|true|value:âœ… Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½|fallback:âŒ Ð’Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½}`
- **ÐÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:** `{is_active|equals:true|value:âœ… Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½}` (ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÑ‚Ñ€Ð¾Ðº)

**Ð”Ð»Ñ string Ð¿Ð¾Ð»ÐµÐ¹:**
- **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ:** `{status|equals:active|value:ÐÐºÑ‚Ð¸Ð²ÐµÐ½|fallback:ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½}`
- ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ `true` Ð½Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ñ‹Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹

### ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹:

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 1: ÐŸÐµÑ€ÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, {username|fallback:Ð“Ð¾ÑÑ‚ÑŒ}!
        
        ðŸ“Š Ð’Ð°ÑˆÐ° ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°:
        â€¢ ID: {user_id}
        â€¢ Ð§Ð°Ñ‚Ð¾Ð²: {chat_count|fallback:0}
        â€¢ ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð²Ñ…Ð¾Ð´: {last_login|format:datetime|fallback:ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾}
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 2: Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¼ÐµÐ½ÑŽ Ñ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼Ð¸**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        ðŸŽ›ï¸ Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ
        
        Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: {user_status|equals:active|value:âœ… ÐÐºÑ‚Ð¸Ð²ÐµÐ½|fallback:âŒ ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½}
        Ð‘Ð°Ð»Ð°Ð½Ñ: {balance|format:currency|fallback:0.00 â‚½}
      inline:
        - [{"ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°": "stats"}, {"ðŸ’° Ð‘Ð°Ð»Ð°Ð½Ñ": "balance"}]
        - [{"âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸": "settings"}]
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 3: ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ñ fallback**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
        
        ÐšÐ¾Ð´ Ð¾ÑˆÐ¸Ð±ÐºÐ¸: {error_code|fallback:UNKNOWN}
        Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ: {error_message|fallback:ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°}
        Ð’Ñ€ÐµÐ¼Ñ: {timestamp|format:datetime}
      inline:
        - [{"ðŸ”„ ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ": "retry"}, {"ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ": "main"}]
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 4: ÐœÐ°Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ñ**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        ðŸ’° Ð Ð°ÑÑ‡ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸
        
        Ð¦ÐµÐ½Ð°: {base_price|format:currency}
        Ð¡ÐºÐ¸Ð´ÐºÐ°: {discount_percent|fallback:0}%
        Ð˜Ñ‚Ð¾Ð³Ð¾: {base_price|*{discount_percent|/100}|*{base_price|-1}|+{base_price}|format:currency}
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 5: Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Ñ‚ÐµÐºÑÑ‚Ð°**
```yaml
step:
  - action: "send_message"
    params:
      text: |
        ðŸ“ ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð·Ð°ÐºÐ°Ð·Ð°
        
        ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð°: "{event_text|regex:Ð·Ð°ÐºÐ°Ð·\\s*(\\d+)|fallback:ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½}"
        Ð¡ÑƒÐ¼Ð¼Ð°: "{event_text|regex:ÑÑƒÐ¼Ð¼Ð°\\s*(\\d+)|format:currency|fallback:0.00 â‚½}"
        Ð’Ñ€ÐµÐ¼Ñ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸: "{event_text|regex:(\\d+)\\s*Ð¼Ð¸Ð½|fallback:30}" Ð¼Ð¸Ð½ÑƒÑ‚
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 6: ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ðº ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ (Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾)**
```yaml
step:
  - action: "check_user_role"
    params:
      required_role: "admin"
    transition:
      - action_result: "success"
        transition_action: "jump_to_scenario"
        transition_value: "admin_panel"      # ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ðº Ð°Ð´Ð¼Ð¸Ð½ÐºÐµ, Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ
      - action_result: "error"
        transition_action: "continue"        # ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ
  
  # Ð­Ñ‚Ð¾Ñ‚ ÑˆÐ°Ð³ ÐÐ• Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑÑ, ÐµÑÐ»Ð¸ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð» jump_to_scenario
  - action: "send_message"
    params:
      text: "ÐžÐ±Ñ‹Ñ‡Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 7: ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑˆÐ°Ð³Ð°Ð¼**
```yaml
step:
  - action: "check_permissions"
    params:
      required_role: "admin"
    transition:
      - action_result: "success"
        transition_action: "move_steps"
        transition_value: 2                 # ÐŸÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒÑÑ Ð½Ð° 2 ÑˆÐ°Ð³Ð° Ð²Ð¿ÐµÑ€ÐµÐ´ (Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ 1 ÑˆÐ°Ð³, Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ)
      - action_result: "error"
        transition_action: "continue"        # Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑˆÐ°Ð³Ð¸
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 7.1: ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ðº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ ÑˆÐ°Ð³Ñƒ**
```yaml
step:
  - action: "validate"
    params:
      condition: "$user_role == 'admin'"
    transition:
      - action_result: "success"
        transition_action: "jump_to_step"
        transition_value: 5                 # ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº ÑˆÐ°Ð³Ñƒ Ñ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ 5 (ÑˆÐ°Ð³Ð¸ Ð½ÑƒÐ¼ÐµÑ€ÑƒÑŽÑ‚ÑÑ Ñ 0)
      - action_result: "failed"
        transition_action: "continue"       # ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ
```

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 8: Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ "any"**
```yaml
step:
  - action: "send_message"
    params:
      text: "Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾"
    transition:
      - action_result: "any"                 # Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ð¾Ñ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°
        transition_action: "abort"           # Ð’ÑÐµÐ³Ð´Ð° Ð¿Ñ€ÐµÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ
      - action_result: "success"
        transition_action: "continue"        # âŒ Ð­Ñ‚Ð¾Ñ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ ÐÐ• Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑÑ Ð¸Ð·-Ð·Ð° "any"
      - action_result: "error"
        transition_action: "continue"        # âŒ Ð­Ñ‚Ð¾Ñ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ ÐÐ• Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑÑ Ð¸Ð·-Ð·Ð° "any"
```

**âš ï¸ Ð’Ð°Ð¶Ð½Ð¾:** ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ `any` Ð¸Ð¼ÐµÐµÑ‚ Ð²Ñ‹ÑÑˆÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ Ð¸ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð²ÑÐµÑ… Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð². Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð²ÑÐµÐ³Ð´Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ð´Ð¸Ð½ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ð¸Ð· Ð²ÑÐµÑ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ñ….

#### **ÐŸÑ€Ð¸Ð¼ÐµÑ€ 9: Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð° Ñ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð¾Ð¼ expand**
```yaml
step:
  # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð²
  - action: "get_tenants_list"
    params: {}
  
  # Ð¡Ñ‚Ñ€Ð¾Ð¸Ð¼ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÑƒÑŽ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ Ð¸Ð· Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð²
  - action: "build_keyboard"
    params:
      items: "{public_tenant_ids}"
      keyboard_type: "inline"
      text_template: "Tenant $value$"
      callback_template: "select_tenant_$value$"
      buttons_per_row: 2
  
  # ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð¾Ð¹ + ÑÑ‚Ð°Ñ‚Ð¸Ñ‡Ð½Ñ‹Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸
  - action: "send_message"
    params:
      text: "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚ÐµÐ½Ð°Ð½Ñ‚:"
      inline:
        - "{keyboard|expand}"              # Ð Ð°Ð·Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÑƒÑŽ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñƒ
        - [{"ðŸ”™ ÐÐ°Ð·Ð°Ð´": "main_menu"}]      # Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡Ð½Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ°
```

**ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ `expand`:**
- ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ `expand` Ñ€Ð°Ð·Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¼Ð°ÑÑÐ¸Ð² Ð¼Ð°ÑÑÐ¸Ð²Ð¾Ð² Ð½Ð° Ð¾Ð´Ð¸Ð½ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ **Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð² Ð¼Ð°ÑÑÐ¸Ð²Ðµ**
- Ð’ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ Ð²Ñ‹ÑˆÐµ `{keyboard|expand}` Ð² Ð¼Ð°ÑÑÐ¸Ð²Ðµ `inline` Ñ€Ð°Ð·Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ `[[{...}, {...}], [{...}]]` Ð² `[{...}, {...}], [{...}]`
- Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñ‹ ÑÐ¾ ÑÑ‚Ð°Ñ‚Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ ÑÑ‚Ñ€Ð¾ÐºÐ°Ð¼Ð¸
- **Ð’Ð°Ð¶Ð½Ð¾:** `expand` Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ðµ Ð¼Ð°ÑÑÐ¸Ð²Ð°. Ð’ ÑÑ‚Ñ€Ð¾ÐºÐµ Ð¸Ð»Ð¸ ÑÐ»Ð¾Ð²Ð°Ñ€Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð±ÐµÐ· expand (Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾):**
```yaml
inline:
  - "{keyboard}"                           # âŒ ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑÑ [[[...]], [...]] - 3 ÑƒÑ€Ð¾Ð²Ð½Ñ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸!
  - [{"ðŸ”™ ÐÐ°Ð·Ð°Ð´": "main_menu"}]
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ expand (Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾):**
```yaml
inline:
  - "{keyboard|expand}"                     # âœ… ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑÑ [[...], [...]] - 2 ÑƒÑ€Ð¾Ð²Ð½Ñ Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸
  - [{"ðŸ”™ ÐÐ°Ð·Ð°Ð´": "main_menu"}]
```

---

## âš¡ ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (Async Actions)

**ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ:** Ð—Ð°Ð¿ÑƒÑÐº Ð´Ð¾Ð»Ð³Ð¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð² Ñ„Ð¾Ð½Ðµ Ñ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°.

### ÐœÐµÑ…Ð°Ð½Ð¸ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:

ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð´Ð¾Ð»Ð³Ð¸Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ðº LLM, Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…) Ð² Ñ„Ð¾Ð½Ðµ, Ð½Ðµ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ. Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ, Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð¸ Ð¾Ð¶Ð¸Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ ÐºÐ¾Ð³Ð´Ð° ÑÑ‚Ð¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾.

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ:

```yaml
step:
  - step_id: 1
    action_name: "ai_request"
    async: true                    # Ð¤Ð»Ð°Ð³ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
    action_id: "ai_req_1"         # Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ID Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½)
    params:
      prompt: "ÐŸÑ€Ð¸Ð²ÐµÑ‚!"
```

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- **`async: true`** â€” Ñ„Ð»Ð°Ð³, Ñ‡Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒÑÑ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾
- **`action_id`** â€” ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½ Ð´Ð»Ñ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹)
- **`action_name`** â€” Ð¸Ð¼Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð´Ð»Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
- **`params`** â€” Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ

### ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹:

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ:**

1. **Ð—Ð°Ð¿ÑƒÑÐº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð² Ñ„Ð¾Ð½Ðµ:**
   - ÐŸÑ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¾Ð½Ð¾ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒÑÑ Ð² Ñ„Ð¾Ð½Ðµ, Ð½Ðµ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ
   - Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ, Ð¿Ð¾ÐºÐ° async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ
   - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ

2. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð² `_async_action`:**
   - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‰ÐµÐµÑÑ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð² ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ð¾Ð»Ðµ `_async_action[action_id]`
   - `_async_action` â€” ÑÑ‚Ð¾ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ ÑÐ»Ð¾Ð²Ð°Ñ€ÑŒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð²ÑÐµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð½Ñ‹Ðµ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
   - ÐšÐ»ÑŽÑ‡ ÑÐ»Ð¾Ð²Ð°Ñ€Ñ â€” ÑÑ‚Ð¾ `action_id` (ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ñ‹ ÑƒÐºÐ°Ð·Ð°Ð»Ð¸), Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ â€” ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‰ÐµÐµÑÑ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ
   - **Ð’Ð°Ð¶Ð½Ð¾:** `_async_action` Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ñ‚ `_cache`, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¼ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ ÑˆÐ°Ð³Ð°Ð¼Ð¸

3. **ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ:**
   - ÐšÐ¾Ð³Ð´Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚ÑÑ (ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð»Ð¸ Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ¾Ð¹), ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ ÐµÐ³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
   - ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð² Ñ„Ð¾Ð½Ðµ, Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ð¾Ñ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ
   - ÐœÐ¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ `{_async_action.action_id|ready}` Ð² Ð»ÑŽÐ±Ð¾Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚

**ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ `{_async_action.action_id|ready}`:**

- `_async_action` â€” ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ðµ Ð¿Ð¾Ð»Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹
- `action_id` â€” ÑÑ‚Ð¾ ID, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ñ‹ ÑƒÐºÐ°Ð·Ð°Ð»Ð¸ Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `"ai_req_1"`)
- `ready` â€” Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚, Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ Ð»Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ (Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ `True` ÐµÑÐ»Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾, `False` ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ)
- Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ… Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸ÑÐ¼Ð¸

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ:
- `_async_action["ai_req_1"]` â€” ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð¿ÐµÑ€Ð²Ñ‹Ð¹ AI Ð·Ð°Ð¿Ñ€Ð¾Ñ
- `_async_action["data_proc_1"]` â€” ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
- `_async_action["ai_req_2"]` â€” ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ AI Ð·Ð°Ð¿Ñ€Ð¾Ñ

Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð»ÑŽÐ±Ð¾Ð³Ð¾ Ð¸Ð· Ð½Ð¸Ñ… Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€: `{_async_action.ai_req_1|ready}`

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸:

Ð”Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð¼Ð¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹ `ready` Ð¸ `not_ready` Ð² Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°Ñ…. Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸ÑÐ¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñ‹.

**ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹:**
- **`{_async_action.action_id|ready}`** â€” Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ `True` ÐµÑÐ»Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾, `False` ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ
- **`{_async_action.action_id|not_ready}`** â€” Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ `True` ÐµÑÐ»Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ ÐµÑ‰Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ, `False` ÐµÑÐ»Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾

**ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:**
- ÐŸÐ»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ `{_async_action.action_id|ready}` Ð¾Ð±Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ðº ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð¼Ñƒ Ð¿Ð¾Ð»ÑŽ `_async_action` Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¼ `action_id`
- ÐœÐ¾Ð´Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ `ready` Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚, Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ Ð»Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ â€” Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ `True` ÐµÑÐ»Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾, `False` ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ
- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ… Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ñ†Ð¸ÐºÐ»Ð¾Ð² Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ Ð¸ ÑÐ»Ð¾Ð¶Ð½Ð¾Ð¹ Ð»Ð¾Ð³Ð¸ÐºÐ¸

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸:**
```yaml
step:
  - action: "validate"
    params:
      condition: "{_async_action.ai_req_1|ready} == True"  # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ
    transition:
      - action_result: "failed"
        transition_action: "move_steps"
        transition_value: -2  # Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ÑÑ Ð½Ð°Ð·Ð°Ð´, ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð½Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾
```

### ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°:

Ð”Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ `wait_for_action`:

```yaml
step:
  - step_id: 3
    action_name: "wait_for_action"
    params:
      action_id: "ai_req_1"
      timeout: 60  # ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ð² ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…
```

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- **`action_id`** â€” ID Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð´Ð»Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½)
- **`timeout`** â€” Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ Ð² ÑÐµÐºÑƒÐ½Ð´Ð°Ñ… (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
- `wait_for_action` Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ **AS IS** (ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ Ð¾Ð½Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ð»Ð¾ÑÑŒ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ)
- Ð•ÑÐ»Ð¸ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»Ð¾ÑÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ â†’ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ ÐµÐ³Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ `response_data`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð² Ð¿Ð»Ð¾ÑÐºÐ¸Ð¹ `_cache` (Ð¸Ð»Ð¸ `_cache[_namespace]` ÐµÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½ `_namespace`, Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñ‹ ÐºÐ»ÑŽÑ‡Ð° Ñ‡ÐµÑ€ÐµÐ· `_response_key`)
- Ð•ÑÐ»Ð¸ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»Ð¾ÑÑŒ Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ¾Ð¹ â†’ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ ÐµÐ³Ð¾ Ð¾ÑˆÐ¸Ð±ÐºÐ°
- Ð•ÑÐ»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ° Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ (Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚, Future Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½) â†’ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ð¾ÑˆÐ¸Ð±ÐºÐ° `wait_for_action`

### ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÑ€:

```yaml
ai_processing:
  description: "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº AI Ñ Ð¿Ð¾ÐºÐ°Ð·Ð¾Ð¼ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸"
  trigger:
    - event_type: "message"
      event_text: "/ai"

  step:
    # Ð¨Ð°Ð³ 1: Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ AI Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾
    - action: "completion"
      async: true
      action_id: "ai_req_1"
      params:
        prompt: "{event_text|regex:/ai\\s+(.+)}"
    
    # Ð¨Ð°Ð³ 2: ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ
    - action: "send_message"
      params:
        text: "â³ ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÑŽ Ð·Ð°Ð¿Ñ€Ð¾Ñ..."
    
    # Ð¨Ð°Ð³ 3: Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð¿ÐµÑ€ÐµÐ´ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¾Ð¹
    - action: "sleep"
      params:
        seconds: 1.0  # Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° 1 ÑÐµÐºÑƒÐ½Ð´Ð° Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°Ð¼Ð¸
    
    # Ð¨Ð°Ð³ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ
    # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ {_async_action.ai_req_1|ready} Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
    - action: "validate"
      params:
        condition: "{_async_action.ai_req_1|ready} == True"
      transition:
        - action_result: "failed"
          transition_action: "move_steps"
          transition_value: -1  # Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ÑÑ Ð½Ð° ÑˆÐ°Ð³ Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ (ÑˆÐ°Ð³ 3), ÐµÑÐ»Ð¸ ÐµÑ‰Ðµ Ð½Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾
    
    # Ð¨Ð°Ð³ 5: Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ (Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð³Ð´Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾)
    - action: "delete_message"
      params:
        delete_message_id: "{last_message_id}"
    
    # Ð¨Ð°Ð³ 6: ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ AI (Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚)
    - action: "wait_for_action"
      params:
        action_id: "ai_req_1"
        timeout: 60  # Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚ 60 ÑÐµÐºÑƒÐ½Ð´
    # response_data Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð² Ð¿Ð»Ð¾ÑÐºÐ¸Ð¹ _cache = {response_completion: "ÐžÑ‚Ð²ÐµÑ‚ Ð¾Ñ‚ AI", prompt_tokens: 50, completion_tokens: 100}
    
    # Ð¨Ð°Ð³ 7: ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ AI
    - action: "send_message"
      params:
        text: "{_cache.response_completion|fallback:ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸}"
```

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð² ÑÑ‚Ð¾Ð¼ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ:**
1. Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ â€” ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ð½ÐµÐ³Ð¾ Ð² `_async_action["ai_req_1"]`
2. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ
3. Ð”ÐµÐ»Ð°ÐµÑ‚ÑÑ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° 1 ÑÐµÐºÑƒÐ½Ð´Ð° (Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ 100% CPU)
4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ÑÑ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ â€” Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€ `{_async_action.ai_req_1|ready}` Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚, Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ Ð»Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ
5. Ð•ÑÐ»Ð¸ Ð½Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ â€” Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð½Ð° ÑˆÐ°Ð³ Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ (Ñ†Ð¸ÐºÐ»: Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° â†’ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° â†’ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° â†’ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°...)
6. Ð•ÑÐ»Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ â€” ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°

**Ð­Ñ‚Ð¾Ñ‚ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚:**
- ÐšÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ñ†Ð¸ÐºÐ»Ð¾Ð² Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ
- ÐšÐ°Ðº Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ†Ð¸ÐºÐ» Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ Ð´Ð»Ñ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ 100% CPU
- ÐœÐµÑ…Ð°Ð½Ð¸Ð·Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð° `{_async_action.action_id|ready}` Ð² ÑƒÑÐ»Ð¾Ð²Ð¸ÑÑ… Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸

### Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸:

**1. Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡ÐµÑ€ÐµÐ· `wait_for_action`:**
- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð² `_cache` ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ð° `wait_for_action`
- `wait_for_action` Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¸Ð· Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÐµÐ³Ð¾ ÐºÐ°Ðº Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð² Ð¿Ð»Ð¾ÑÐºÐ¸Ð¹ `_cache` (Ð¸Ð»Ð¸ `_cache[_namespace]` ÐµÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½ `_namespace`, Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñ‹ ÐºÐ»ÑŽÑ‡Ð° Ñ‡ÐµÑ€ÐµÐ· `_response_key`)
- Ð‘ÐµÐ· `wait_for_action` Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð¸ Ð½Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð² ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹

**2. ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹:**
- ÐœÐ¾Ð¶Ð½Ð¾ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ñ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ `action_id`
- ÐšÐ°Ð¶Ð´Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ Ñ‡ÐµÑ€ÐµÐ· ÑÐ²Ð¾Ð¹ `action_id` Ð² `_async_action`
- ÐœÐ¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾: `{_async_action.action_id_1|ready}`, `{_async_action.action_id_2|ready}`
- ÐœÐ¾Ð¶Ð½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ: `{_async_action.ai_1|ready} and {_async_action.data_1|ready}`

**3. Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ñ‹:**
- ÐœÐ¾Ð¶Ð½Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ `timeout` Ð² `wait_for_action` Ð´Ð»Ñ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ
- ÐŸÑ€Ð¸ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¸Ð¸ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð° `wait_for_action` Ð²ÐµÑ€Ð½ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ `timeout`, Ð½Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÑ‚ÑÑ
- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒÑÑ Ð² Ñ„Ð¾Ð½Ðµ Ð´Ð°Ð¶Ðµ Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð° â€” ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð¾ÑÑ‚Ð°Ð½ÐµÑ‚ÑÑ Ð² `_async_action` Ð¸ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ð·Ð¶Ðµ

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ð¼Ð¸ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸ÑÐ¼Ð¸:

```yaml
parallel_processing:
  description: "ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²"
  trigger:
    - event_type: "message"
      event_text: "/process"

  step:
    # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾
    - action: "completion"
      async: true
      action_id: "ai_1"
      params:
        prompt: "Ð’Ð¾Ð¿Ñ€Ð¾Ñ 1"
    # response_data: {"response_completion": "ÐžÑ‚Ð²ÐµÑ‚ 1", "prompt_tokens": 50, "completion_tokens": 100}
    
    - action: "process_data"
      async: true
      action_id: "data_proc_1"
      params:
        data: "{event_text}"
    # response_data: {"processed_data": "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ", "status": "success"}
    
    # ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ AI (ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð² _cache)
    # Ð’ÐÐ–ÐÐž: ÐÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ñ†Ð¸ÐºÐ» Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð±ÐµÐ· Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¸ - ÑÑ‚Ð¾ Ð¿Ñ€Ð¸Ð²ÐµÐ´ÐµÑ‚ Ðº 100% CPU!
    # ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð¶Ð´ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· wait_for_action Ñ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð¾Ð¼
    - action: "wait_for_action"
      params:
        action_id: "ai_1"
        timeout: 60  # Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚ 60 ÑÐµÐºÑƒÐ½Ð´
    # wait_for_action Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ AS IS
    # response_data Ð¸Ð· Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð² Ð¿Ð»Ð¾ÑÐºÐ¸Ð¹ _cache = {response_completion: "ÐžÑ‚Ð²ÐµÑ‚ 1", prompt_tokens: 50, completion_tokens: 100}
    
    # ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… (ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð² _cache)
    - action: "wait_for_action"
      params:
        action_id: "data_proc_1"
        timeout: 30  # Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚ 30 ÑÐµÐºÑƒÐ½Ð´
        _namespace: "data_processing"  # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¾Ð±Ð¾Ð¸Ñ… Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð²
    # response_data Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð² _cache.data_processing = {processed_data: "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ", status: "success"}
    
    # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ (Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ñ‡ÐµÑ€ÐµÐ· _cache)
    - action: "send_message"
      params:
        text: |
          AI Ð¾Ñ‚Ð²ÐµÑ‚: {_cache.response_completion|fallback:ÐÐµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½}
          Ð¢Ð¾ÐºÐµÐ½Ñ‹: {_cache.completion_tokens|fallback:0}
          ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ: {_cache.data_processing.processed_data|fallback:ÐÐµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ñ‹}
          Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: {_cache.data_processing.status|fallback:ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾}
```

**â„¹ï¸ Ð’Ð°Ð¶Ð½Ð¾:** 
- `wait_for_action` Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ **AS IS** (ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ Ð¾Ð½Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ð»Ð¾ÑÑŒ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ)
- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ `scenario_engine` ÐºÐ°Ðº Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¹ `response_data`
- Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð¿Ð°Ð´Ð°ÑŽÑ‚ Ð² Ð¿Ð»Ð¾ÑÐºÐ¸Ð¹ `_cache` (Ð¸Ð»Ð¸ `_cache[_namespace]` ÐµÑÐ»Ð¸ ÑƒÐºÐ°Ð·Ð°Ð½ `_namespace`, Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñ‹ ÐºÐ»ÑŽÑ‡Ð° Ñ‡ÐµÑ€ÐµÐ· `_response_key`)
- Ð•ÑÐ»Ð¸ `wait_for_action` Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð´Ð²Ð°Ð¶Ð´Ñ‹ Ð±ÐµÐ· `_namespace`, Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿Ð¸ÑˆÐµÑ‚ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ (Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¼ÐµÑ€Ð¶Ð°Ñ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¾Ðµ ÑÐ»Ð¸ÑÐ½Ð¸Ðµ)
- **Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `_namespace` Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ñ€Ð°Ð·Ð½Ñ‹Ñ… async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð² Ñ€Ð°Ð·Ð½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸
- **Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `_response_key` Ð´Ð»Ñ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ð¹ Ð¿Ð¾Ð´Ð¼ÐµÐ½Ñ‹ ÐºÐ»ÑŽÑ‡Ð° replaceable Ð¿Ð¾Ð»Ñ Ð² Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ñ… async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹

### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸:

1. **Ð’ÑÐµÐ³Ð´Ð° ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ `action_id`** Ð´Ð»Ñ async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ â€” ÑÑ‚Ð¾ ÐµÐ´Ð¸Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… ÑÑ‚Ð°Ñ‚ÑƒÑ
2. **Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ñ‹** Ð² `wait_for_action` Ð´Ð»Ñ Ð´Ð¾Ð»Ð³Ð¸Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ â€” ÑÑ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ð¾Ðµ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ðµ
3. **ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸** â€” Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ `transition` Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ `error` Ð¸ `timeout` Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð² `wait_for_action`
4. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ†Ð¸ÐºÐ»Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹** â€” ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶ÐµÐ½ Ñ†Ð¸ÐºÐ» Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸, Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ `sleep` Ð¿ÐµÑ€ÐµÐ´ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð¼ Ðº Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐµ
5. **Ð”Ð»Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `wait_for_action` Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ** â€” Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ñ†Ð¸ÐºÐ»Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¶Ð´Ð¸Ñ‚Ðµ ÐºÐ°Ð¶Ð´Ð¾Ðµ Ñ‡ÐµÑ€ÐµÐ· `wait_for_action` Ñ Ñ‚Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð¾Ð¼
6. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `_namespace`** Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ñ€Ð°Ð·Ð½Ñ‹Ñ… async Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð² Ñ€Ð°Ð·Ð½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸ `_cache`
