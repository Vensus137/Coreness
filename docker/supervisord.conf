[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
socket=/var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[program:main]
command=python main.py
directory=/workspace
autostart=true
autorestart=true
startretries=3
startsecs=10
# Настройки для graceful shutdown
stopsignal=TERM          # Сигнал для остановки (SIGTERM)
stopwaitsecs=10          # Время ожидания перед SIGKILL (10 секунд)
killasgroup=true         # Убивать всю группу процессов при принудительной остановке
stopasgroup=true         # Останавливать всю группу процессов при остановке
# Логи идут напрямую в stdout/stderr для Docker
# Docker собирает логи автоматически, можно использовать docker-compose logs
# Приложение само пишет в файл через FileHandler (logs/core.log)
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
# Убираем лимиты для stdout/stderr в Docker (Docker сам управляет)
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
environment=PYTHONUNBUFFERED="1"

